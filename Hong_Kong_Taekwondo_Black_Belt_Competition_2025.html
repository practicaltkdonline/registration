<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>香港跆拳道黑帶賽 2025 報名表_實用會</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans TC', Arial, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    .form-container {
      background: white;
      padding: 32px;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
    }
    .form-header {
      text-align: center;
      margin-bottom: 32px;
    }
    .form-header h1 {
      font-size: 28px;
      font-weight: 700;
      color: #333;
    }
    .form-header h2 {
      font-size: 20px;
      font-weight: 500;
      color: #555;
      margin-top: 8px;
    }
    .form-group {
      margin-bottom: 24px;
      padding: 16px;
      border-radius: 8px;
    }
    .form-group:nth-child(odd) {
      background-color: #F7FAFC;
    }
    .form-group:nth-child(even) {
      background-color: #FFFFFF;
    }
    .sub-form-group {
      margin-bottom: 24px;
      padding: 16px;
      border-radius: 8px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      font-size: 16px;
      color: #333;
    }
    input, select, button {
      width: 100%;
      padding: 12px;
      border: 1px solid #B0BEC5;
      border-radius: 8px;
      box-sizing: border-box;
      font-size: 16px;
      transition: border-color 0.3s, box-shadow 0.3s;
    }
    input:focus, select:focus, button:focus {
      outline: none;
      border-color: #1976D2;
      box-shadow: 0 0 6px rgba(25, 118, 210, 0.3);
    }
    .date-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .date-group select {
      width: 120px;
    }
    .date-group select#birthYear, .date-group select#certYear, .date-group select#otherCertYear {
      width: 160px;
    }
    .date-group span {
      font-size: 16px;
      color: #333;
    }
    .category-group {
      display: flex;
      flex-direction: column;
      gap: 16px;
      padding: 8px 0;
    }
    .category-group label {
      display: flex;
      align-items: center;
      font-weight: normal;
      font-size: 16px;
    }
    .category-group input[type="radio"],
    .category-group input[type="checkbox"] {
      width: auto;
      margin-right: 12px;
    }
    .error {
      color: #D32F2F;
      font-size: 14px;
      margin-top: 6px;
      display: none;
    }
    .info {
      color: #1976D2;
      font-size: 14px;
      margin-top: 6px;
      display: none;
    }
    .membership-group {
      display: flex;
      align-items: center;
      gap: 12px; /* 減少間距以確保一行 */
    }
    .membership-group input[type="text"] {
      width: 100%;
    }
    .membership-group label {
      display: flex;
      align-items: center;
      font-weight: normal;
      margin: 0;
      white-space: nowrap; /* 防止文字換行 */
    }
    .membership-group input[type="checkbox"] {
      margin: 0;
      width: 16px; /* 縮減 checkbox 寬度 */
      height: 16px; /* 縮減 checkbox 高度 */
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background-color: white;
      padding: 32px;
      border-radius: 12px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      height: 80vh;
      max-height: 600px;
    }
    .modal-scroll {
      overflow-y: auto;
      flex-grow: 1;
      margin-bottom: 20px;
    }
    .modal-content p {
      font-size: 16px;
      margin: 12px 0;
    }
    .event-item {
      margin-bottom: 12px;
    }
    .event-item strong::before {
      content: '．';
      margin-right: 5px;
    }
    .category-item {
      margin-left: 20px;
      margin-top: 4px;
    }
    .category-item::before {
      content: '-';
      margin-right: 5px;
    }
    button.confirm, button.return-button {
      background-color: #1976D2;
      color: white;
      border: none;
      cursor: pointer;
      padding: 12px;
    }
    button.confirm:hover, button.return-button:hover {
      background-color: #1565C0;
      transform: translateY(-2px);
    }
    button.cancel {
      background-color: #B0BEC5;
      color: #333;
      padding: 12px;
    }
    button.cancel:hover {
      background-color: #90A4AE;
      transform: translateY(-2px);
    }
    #submitBtn {
      background-color: #4CAF50;
      color: white;
      margin-top: 20px;
      position: relative;
      padding-right: 40px;
    }
    #submitBtn:hover {
      background-color: #45a049;
      transform: translateY(-2px);
    }
    #thankYouPage {
      display: none;
      background: white;
      padding: 32px;
      border-radius: 12px;
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
      text-align: center;
    }
    #thankYouPage h2 {
      font-size: 24px;
      margin-bottom: 16px;
      color: #333;
    }
    #thankYouPage p {
      font-size: 16px;
      margin: 16px 0;
      color: #155724;
    }
    #affiliation {
      pointer-events: none;
      background-color: #f5f5f5;
    }
    @media (max-width: 600px) {
      .form-container, #thankYouPage {
        padding: 24px;
      }
      .modal-content {
        width: 95%;
        padding: 24px;
        height: 85vh;
        max-height: 500px;
      }
      .date-group {
        gap: 8px;
      }
      .date-group select {
        width: 70px;
      }
      .date-group select#birthYear, .date-group select#certYear, .date-group select#otherCertYear {
        width: 110px;
      }
      .form-header h1 {
        font-size: 24px;
      }
      .form-header h2 {
        font-size: 18px;
      }
      .sub-form-group {
        padding: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="form-container" id="mainForm">
    <div class="form-header">
      <h1>香港跆拳道黑帶賽 2025</h1>
      <h1>Hong Kong Taekwondo Black Belt Competition 2025</h1>
      <h2>報名表 (實用會)</h2>
    </div>
    <form id="registrationForm">
      <div class="form-group">
        <label>中文姓名 Chinese Name *</label>
        <input type="text" id="chineseName" name="entry.202432610" required>
        <span id="chineseNameError" class="error">請輸入中文姓名</span>
      </div>
      <div class="form-group">
        <label>英文姓名 English Name *</label>
        <input type="text" id="englishName" name="entry.1628056645" required oninput="this.value = this.value.toUpperCase()">
        <span id="englishNameError" class="error">請輸入英文姓名</span>
      </div>
      <div class="form-group">
        <label>出生日期 Date of Birth YYYY-MM-DD *</label>
        <div class="date-group">
          <select id="birthYear" name="entry.1692065916_year" required>
            <option value="">年</option>
          </select>
          <span>/</span>
          <select id="birthMonth" name="entry.1692065916_month" required>
            <option value="">月</option>
          </select>
          <span>/</span>
          <select id="birthDay" name="entry.1692065916_day" required>
            <option value="">日</option>
          </select>
        </div>
        <input type="hidden" id="birthDate" name="entry.1692065916">
        <span id="birthDateError" class="error">請選擇有效的出生日期</span>
      </div>
      <div class="form-group">
        <label>國藉 Nationality *</label>
        <input type="text" id="nationality" name="entry.629417934" required>
        <span id="nationalityError" class="error">請輸入國籍</span>
      </div>
      <div class="form-group">
        <label>高度 Height (cm) *</label>
        <input type="number" id="height" name="entry.2080147979" min="0" required>
        <span id="heightError" class="error">請輸入有效的身高（厘米）</span>
      </div>
      <div class="form-group">
        <label>重量 Weight (kg) *</label>
        <input type="number" id="weight" name="entry.1898274578" min="0" step="0.1" required>
        <span id="weightError" class="error">請輸入有效的體重（公斤）</span>
      </div>
      <div class="form-group">
        <label>聯絡電話 Telephone Number *</label>
        <input type="tel" id="phone" name="entry.621996143" pattern="\d{8}" required>
        <span id="phoneError" class="error">請輸入有效的8位電話號碼</span>
      </div>
      <div class="form-group">
        <label>中國香港跆拳道協會品段證/現有黑帶會員証編號 HKTKDA Poom/ Dan or Membership Card No. *</label>
        <input type="text" id="membershipNumber" name="entry.1754862681">
        <div class="membership-group">
          <label><input type="checkbox" id="membershipPending" name="membershipPending" onchange="toggleMembershipInput()">  申請中 (如未有品段/黑帶會員證)</label>
        </div>
        <span id="membershipNumberError" class="error">請輸入會員証或品段證編號或勾選申請中</span>
      </div>
      <div class="form-group">
        <label>現有段位/級別 Present Grade Held *</label>
        <input type="text" id="beltLevel" name="entry.1594602137" required>
        <span id="beltLevelError" class="error">請輸入現有段位/級別</span>
      </div>
      <div class="form-group">
        <label>品段/黑帶段證申請日期 Poom/ Dan Cert. application date *</label>
        <div class="date-group">
          <select id="certYear" name="entry.768158226_year" required>
            <option value="">年</option>
          </select>
          <span>/</span>
          <select id="certMonth" name="entry.768158226_month" required>
            <option value="">月</option>
          </select>
          <span>/</span>
          <select id="certDay" name="entry.768158226_day" required>
            <option value="">日</option>
          </select>
        </div>
        <input type="hidden" id="certDate" name="entry.768158226">
        <span id="certDateError" class="error">請選擇有效的申請日期</span>
      </div>
      <div class="form-group">
        <label>屬會名稱 Association *</label>
        <select id="affiliation" name="entry.393150406" required>
          <option value="香港實用跆拳道協會 HK Practical TKD Association" selected>香港實用跆拳道協會 HK Practical TKD Association</option>
        </select>
      </div>
      <div class="form-group">
        <label>參加者有沒有持有其他品段/黑帶證? *</label>
        <div class="category-group">
          <label><input type="radio" name="entry.1763143201" value="有" required> 有</label>
          <label><input type="radio" name="entry.1763143201" value="沒有"> 沒有</label>
        </div>
        <span id="otherCertError" class="error">請選擇是否持有其他品段/黑帶證</span>
      </div>
      <div class="form-group">
        <label>持有其他品段/黑帶段證 現有段位 (如適用)</label>
        <input type="text" id="otherBeltLevel" name="entry.463372809">
        <span id="otherBeltLevelError" class="error" style="display: none;">請輸入現有段位（如適用）</span>
      </div>
      <div class="form-group">
        <label>持有其他品段/黑帶段證 發證日期 (如適用)</label>
        <div class="date-group">
          <select id="otherCertYear" name="entry.71831530_year">
            <option value="">年</option>
          </select>
          <span>/</span>
          <select id="otherCertMonth" name="entry.71831530_month">
            <option value="">月</option>
          </select>
          <span>/</span>
          <select id="otherCertDay" name="entry.71831530_day">
            <option value="">日</option>
          </select>
        </div>
        <input type="hidden" id="otherCertDate" name="entry.71831530">
        <span id="otherCertDateError" class="error" style="display: none;">請選擇有效的發證日期</span>
      </div>
      <div class="form-group">
        <label>持有其他品段/黑帶段證 發證機構 (如適用)</label>
        <input type="text" id="otherCertIssuer" name="entry.1095355781">
        <span id="otherCertIssuerError" class="error" style="display: none;">請輸入發證機構（如適用）</span>
      </div>
      <div class="form-group">
        <label>級別劃分 Divisions *</label>
        <select id="division" name="entry.1506275042" onchange="updateWeightClass()" required>
          <option value="">請選擇級別</option>
          <option value="男子黑帶A組 Boys Black Belt Group A 18歲或以上 Age: 18 or Above (2007年或之前出生者)">男子黑帶A組 Boys Black Belt Group A 18歲或以上 Age: 18 or Above (2007年或之前出生者)</option>
          <option value="男子黑帶B組 Boys Black Belt Group B 21歲或以上 Age: 21 or Above (2004年或以前出生者)">男子黑帶B組 Boys Black Belt Group B 21歲或以上 Age: 21 or Above (2004年或以前出生者)</option>
          <option value="男子青少年黑帶組 Boys Junior Black Belt Group 15歲至17歲 Age: 15 to 17(2008年至2010年出生者)">男子青少年黑帶組 Boys Junior Black Belt Group 15歲至17歲 Age: 15 to 17(2008年至2010年出生者)</option>
          <option value="男子少年品段組 Boys Junior Poom Dan Group 12至14歲 Age: 12 to 14 (2011年至2013年出生者)">男子少年品段組 Boys Junior Poom Dan Group 12至14歲 Age: 12 to 14 (2011年至2013年出生者)</option>
          <option value="女子黑帶A組 Girls Black Belt Group A 18歲或以上 Age: 18 or Above (2007年或之前出生者)">女子黑帶A組 Girls Black Belt Group A 18歲或以上 Age: 18 or Above (2007年或之前出生者)</option>
          <option value="女子黑帶B組 Girls Black Belt Group B 21歲或以上 Age: 21 or Above (2004年或以前出生者)">女子黑帶B組 Girls Black Belt Group B 21歲或以上 Age: 21 or Above (2004年或以前出生者)</option>
          <option value="女子青少年黑帶組 Girls Junior Black Belt Group 15歲至17歲 Age: 15 to 17(2008年至2010年出生者)">女子青少年黑帶組 Girls Junior Black Belt Group 15歲至17歲 Age: 15 to 17(2008年至2010年出生者)</option>
          <option value="女子少年品段組 Girls Junior Poom Dan Group 12至14歲 Age: 12 to 14 (2011年至2013年出生者)">女子少年品段組 Girls Junior Poom Dan Group 12至14歲 Age: 12 to 14 (2011年至2013年出生者)</option>
          <option value="女童品段組 Girls Poom Dan Group 10歲至11歲 Age: 10 to 11(2014年至2015年出生者)">女童品段組 Girls Poom Dan Group 10歲至11歲 Age: 10 to 11(2014年至2015年出生者)</option>
        </select>
        <span id="divisionError" class="error">請選擇級別劃分</span>
      </div>
      <div class="form-group" id="kyorugiGroup">
        <div class="sub-form-group">
          <label>各級別劃分 (Divisions) 的重量級別選項 *</label>
          <select id="weightClass" name="entry.1269148047" required>
            <option value="">請選擇重量級別</option>
          </select>
          <span id="weightClassError" class="error">請選擇重量級別</span>
        </div>
      </div>
      <button type="button" id="submitBtn" onclick="submitForm()">提交表單</button>
    </form>
  </div>

  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <div class="modal-scroll">
        <h2>請確認您的報名資料</h2>
        <p><strong>中文姓名：</strong> <span id="confirmChineseName"></span></p>
        <p><strong>英文姓名：</strong> <span id="confirmEnglishName"></span></p>
        <p><strong>出生日期：</strong> <span id="confirmBirthDate"></span></p>
        <p><strong>國藉：</strong> <span id="confirmNationality"></span></p>
        <p><strong>高度：</strong> <span id="confirmHeight"></span></p>
        <p><strong>重量：</strong> <span id="confirmWeight"></span></p>
        <p><strong>聯絡電話：</strong> <span id="confirmPhone"></span></p>
        <p><strong>中國香港跆拳道協會品段證/現有黑帶會員証編號：</strong> <span id="confirmMembershipNumber"></span></p>
        <p><strong>現有段位/級別：</strong> <span id="confirmBeltLevel"></span></p>
        <p><strong>品段/黑帶段證申請日期：</strong> <span id="confirmCertDate"></span></p>
        <p><strong>屬會名稱：</strong> <span id="confirmAffiliation"></span></p>
        <p><strong>是否持有其他品段/黑帶證：</strong> <span id="confirmOtherCert"></span></p>
        <p><strong>其他品段/黑帶段證 現有段位 (如適用)：</strong> <span id="confirmOtherBeltLevel"></span></p>
        <p><strong>其他品段/黑帶段證 發證日期 (如適用)：</strong> <span id="confirmOtherCertDate"></span></p>
        <p><strong>其他品段/黑帶段證 發證機構 (如適用)：</strong> <span id="confirmOtherCertIssuer"></span></p>
        <p><strong>級別劃分：</strong> <span id="confirmDivision"></span></p>
        <p><strong>重量級別：</strong> <span id="confirmWeightClass"></span></p>
      </div>
      <div style="display: flex; gap: 10px;">
        <button class="cancel" onclick="cancelSubmission()">取消</button>
        <button class="confirm" onclick="confirmSubmission()">確認提交</button>
      </div>
    </div>
  </div>

  <div id="thankYouPage">
    <h2>感謝您的報名！</h2>
    <p>確認後教練將盡快與您聯繫。</p>
    <p>費用為 $290 + $100 行政費，共 $390。</p>
    <p>並將PDF最後一頁的同意書及費用交給歐sir或師母。</p>
    <button class="return-button" onclick="restartForm()">重新報名</button>
  </div>

  <script>
    // 鎖定所屬屬會
    const affiliationSelect = document.getElementById('affiliation');
    affiliationSelect.addEventListener('change', (e) => {
      if (e.target.value !== '香港實用跆拳道協會 HK Practical TKD Association') {
        e.target.value = '香港實用跆拳道協會 HK Practical TKD Association';
      }
    });

    // 動態生成年份、月份和日期選項
    function populateDateSelects(yearSelectId, monthSelectId, daySelectId, hiddenInputId, maxYear) {
      const yearSelect = document.getElementById(yearSelectId);
      const monthSelect = document.getElementById(monthSelectId);
      const daySelect = document.getElementById(daySelectId);
      const hiddenInput = document.getElementById(hiddenInputId);

      for (let year = 2025; year >= 1900; year--) {
        let option = document.createElement('option');
        option.value = year;
        option.text = year;
        yearSelect.appendChild(option);
      }
      for (let month = 1; month <= 12; month++) {
        let option = document.createElement('option');
        option.value = month;
        option.text = month.toString().padStart(2, '0');
        monthSelect.appendChild(option);
      }

      function isLeapYear(year) {
        return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
      }

      function updateDays() {
        const year = parseInt(yearSelect.value);
        const month = parseInt(monthSelect.value);
        daySelect.innerHTML = '<option value="">日</option>';
        if (year && month) {
          let daysInMonth = [31, (isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month - 1];
          for (let day = 1; day <= daysInMonth; day++) {
            let option = document.createElement('option');
            option.value = day;
            option.text = day.toString().padStart(2, '0');
            daySelect.appendChild(option);
          }
        }
        updateHiddenInput();
      }

      function updateHiddenInput() {
        const year = yearSelect.value;
        const month = monthSelect.value;
        const day = daySelect.value;
        if (year && month && day) {
          hiddenInput.value = `${year}-${month}-${day}`;
        } else {
          hiddenInput.value = '';
        }
      }

      [yearSelect, monthSelect].forEach(select => {
        select.addEventListener('change', () => {
          updateDays();
          validateDate(yearSelectId, monthSelectId, daySelectId, maxYear);
        });
      });
      updateDays();
    }

    // 日期驗證
    function validateDate(yearSelectId, monthSelectId, daySelectId, maxYear) {
      const yearSelect = document.getElementById(yearSelectId);
      const monthSelect = document.getElementById(monthSelectId);
      const daySelect = document.getElementById(daySelectId);
      const errorElement = document.getElementById(`${yearSelectId.replace('Year', '')}Error`);
      if (errorElement) {
        if (yearSelect.value && monthSelect.value && daySelect.value) {
          const selectedDate = new Date(parseInt(yearSelect.value), parseInt(monthSelect.value) - 1, parseInt(daySelect.value));
          if (!isNaN(selectedDate)) {
            errorElement.style.display = 'none';
            return true;
          } else {
            errorElement.style.display = 'block';
            return false;
          }
        }
        errorElement.style.display = 'none';
      }
      return true;
    }

    // 初始化日期選項
    populateDateSelects('birthYear', 'birthMonth', 'birthDay', 'birthDate', 2025);
    populateDateSelects('certYear', 'certMonth', 'certDay', 'certDate', 2025);
    populateDateSelects('otherCertYear', 'otherCertMonth', 'otherCertDay', 'otherCertDate', 2025);

    // 會員證編號邏輯
    const membershipNumberInput = document.getElementById('membershipNumber');
    const membershipPendingCheckbox = document.getElementById('membershipPending');
    function toggleMembershipInput() {
      if (membershipPendingCheckbox.checked) {
        membershipNumberInput.value = '申請中';
        membershipNumberInput.removeAttribute('required');
        document.getElementById('membershipNumberError').style.display = 'none';
      } else {
        membershipNumberInput.value = '';
        membershipNumberInput.setAttribute('required', 'required');
      }
    }
    membershipPendingCheckbox.addEventListener('change', toggleMembershipInput);

    // 動態更新重量級別選項
    const divisionSelect = document.getElementById('division');
    const weightClassSelect = document.getElementById('weightClass');
    const weightClasses = {
      '男子黑帶A組 Boys Black Belt Group A 18歲或以上 Age: 18 or Above (2007年或之前出生者)': [
        'FIN 鰭量級 (不超過54公斤)', 'FLY 蠅量級 (54公斤以上而不超過58公斤)', 'BANTAM 雛量級 (58公斤以上而不超過63公斤)',
        'FEATHER 羽量級 (63公斤以上而不超過68公斤)', 'LIGHT 輕量級 (68公斤以上而不超過74公斤)', 'WELTER 沉量級 (74公斤以上而不超過80公斤)',
        'MIDDLE 中量級 (80公斤以上而不超過87公斤)', 'HEAVY 重量級 (87公斤以上)'
      ],
      '男子黑帶B組 Boys Black Belt Group B 21歲或以上 Age: 21 or Above (2004年或以前出生者)': [
        'UNDER 58KG (不超過58公斤)', 'UNDER 68KG (58公斤以上而不超過68公斤)', 'UNDER 80KG (68公斤以上而不超過80公斤)', 'OVER 80KG (80公斤以上)'
      ],
      '男子青少年黑帶組 Boys Junior Black Belt Group 15歲至17歲 Age: 15 to 17(2008年至2010年出生者)': [
        'FIN 鰭量級 (不超過45公斤)', 'FLY 蠅量級 (45公斤以上而不超過48公斤)', 'BANTAM 雛量級 (48公斤以上而不超過51公斤)',
        'FEATHER 羽量級 (51公斤以上而不超過55公斤)', 'LIGHT 輕量級 (55公斤以上而不超過59公斤)', 'WELTER 沉量級 (59公斤以上而不超過63公斤)',
        'LIGHT MIDDLE 輕中量級 (63公斤以上而不超過68公斤)', 'MIDDLE 中量級 (68公斤以上而不超過73公斤)',
        'LIGHT HEAVY 輕重量級 (73公斤以上而不超過78公斤)', 'HEAVY 重量級 (78公斤以上)'
      ],
      '男子少年品段組 Boys Junior Poom Dan Group 12至14歲 Age: 12 to 14 (2011年至2013年出生者)': [
        'FIN 鰭量級 (30公斤以上而不超過33公斤)', 'FLY 蠅量級 (33公斤以上而不超過37公斤)', 'BANTAM 雛量級 (37公斤以上而不超過41公斤)',
        'FEATHER 羽量級 (41公斤以上而不超過45公斤)', 'LIGHT 輕量級 (45公斤以上而不超過49公斤)', 'WELTER 沉量級 (49公斤以上而不超過53公斤)',
        'LIGHT MIDDLE 輕中量級 (53公斤以上而不超過57公斤)', 'MIDDLE 中量級 (57公斤以上而不超過61公斤)',
        'LIGHT HEAVY 輕重量級 (61公斤以上而不超過65公斤)', 'HEAVY 重量級 (65公斤以上)'
      ],
      '女子黑帶A組 Girls Black Belt Group A 18歲或以上 Age: 18 or Above (2007年或之前出生者)': [
        'FIN 鰭量級 (不超過46公斤)', 'FLY 蠅量級 (46公斤以上而不超過49公斤)', 'BANTAM 雛量級 (49公斤以上而不超過53公斤)',
        'FEATHER 羽量級 (53公斤以上而不超過57公斤)', 'LIGHT 輕量級 (57公斤以上而不超過62公斤)', 'WELTER 沉量級 (62公斤以上而不超過67公斤)',
        'MIDDLE 中量級 (67公斤以上而不超過73公斤)', 'HEAVY 重量級 (73公斤以上)'
      ],
      '女子黑帶B組 Girls Black Belt Group B 21歲或以上 Age: 21 or Above (2004年或以前出生者)': [
        'UNDER 49KG (不超過49公斤)', 'UNDER 57KG (49公斤以上而不超過57公斤)', 'UNDER 67KG (57公斤以上而不超過67公斤)', 'OVER 67KG (67公斤以上)'
      ],
      '女子青少年黑帶組 Girls Junior Black Belt Group 15歲至17歲 Age: 15 to 17(2008年至2010年出生者)': [
        'FIN 鰭量級 (不超過42公斤)', 'FLY 蠅量級 (42公斤以上而不超過44公斤)', 'BANTAM 雛量級 (44公斤以上而不超過46公斤)',
        'FEATHER 羽量級 (46公斤以上而不超過49公斤)', 'LIGHT 輕量級 (49公斤以上而不超過52公斤)', 'WELTER 沉量級 (52公斤以上而不超過55公斤)',
        'LIGHT MIDDLE 輕中量級 (55公斤以上而不超過59公斤)', 'MIDDLE 中量級 (59公斤以上而不超過63公斤)',
        'LIGHT HEAVY 輕重量級 (63公斤以上而不超過68公斤)', 'HEAVY 重量級 (68公斤以上)'
      ],
      '女子少年品段組 Girls Junior Poom Dan Group 12至14歲 Age: 12 to 14 (2011年至2013年出生者)': [
        'FIN 鰭量級 (26公斤以上而不超過29公斤)', 'FLY 蠅量級 (29公斤以上而不超過33公斤)', 'BANTAM 雛量級 (33公斤以上而不超過37公斤)',
        'FEATHER 羽量級 (37公斤以上而不超過41公斤)', 'LIGHT 輕量級 (41公斤以上而不超過44公斤)', 'WELTER 沉量級 (44公斤以上而不超過47公斤)',
        'LIGHT MIDDLE 輕中量級 (47公斤以上而不超過51公斤)', 'MIDDLE 中量級 (51公斤以上而不超過55公斤)',
        'LIGHT HEAVY 輕重量級 (55公斤以上而不超過59公斤)', 'HEAVY 重量級 (59公斤以上)'
      ],
      '女童品段組 Girls Poom Dan Group 10歲至11歲 Age: 10 to 11(2014年至2015年出生者)': [
        'FIN 鰭量級 (23公斤以上而不超過25公斤)', 'FLY 蠅量級 (25公斤以上而不超過27公斤)', 'BANTAM 雛量級 (27公斤以上而不超過29公斤)',
        'FEATHER 羽量級 (29公斤以上而不超過31公斤)', 'LIGHT 輕量級 (31公斤以上而不超過33公斤)', 'WELTER 沉量級 (33公斤以上而不超過35公斤)',
        'LIGHT MIDDLE 輕中量級 (35公斤以上而不超過37公斤)', 'MIDDLE 中量級 (37公斤以上而不超過39公斤)',
        'LIGHT HEAVY 輕重量級 (39公斤以上而不超過41公斤)', 'HEAVY 重量級 (41公斤以上)'
      ]
    };
    function updateWeightClass() {
      weightClassSelect.innerHTML = '<option value="">請選擇重量級別</option>';
      const selectedDivision = divisionSelect.value;
      if (selectedDivision && weightClasses[selectedDivision]) {
        weightClasses[selectedDivision].forEach(weight => {
          let option = document.createElement('option');
          option.value = weight;
          option.text = weight;
          weightClassSelect.appendChild(option);
        });
      }
    }
    divisionSelect.addEventListener('change', updateWeightClass);

    // 表單驗證與提交
    function submitForm() {
      const confirmModal = document.getElementById('confirmModal');
      const form = document.getElementById('registrationForm');
      const chineseNameInput = document.getElementById('chineseName');
      const englishNameInput = document.getElementById('englishName');
      const birthYearSelect = document.getElementById('birthYear');
      const birthMonthSelect = document.getElementById('birthMonth');
      const birthDaySelect = document.getElementById('birthDay');
      const nationalityInput = document.getElementById('nationality');
      const heightInput = document.getElementById('height');
      const weightInput = document.getElementById('weight');
      const phoneInput = document.getElementById('phone');
      const membershipNumberInput = document.getElementById('membershipNumber');
      const membershipPendingCheckbox = document.getElementById('membershipPending');
      const beltLevelInput = document.getElementById('beltLevel');
      const certYearSelect = document.getElementById('certYear');
      const certMonthSelect = document.getElementById('certMonth');
      const certDaySelect = document.getElementById('certDay');
      const affiliationSelect = document.getElementById('affiliation');
      const otherCertRadios = document.getElementsByName('entry.1763143201');
      const otherBeltLevelInput = document.getElementById('otherBeltLevel');
      const otherCertYearSelect = document.getElementById('otherCertYear');
      const otherCertMonthSelect = document.getElementById('otherCertMonth');
      const otherCertDaySelect = document.getElementById('otherCertDay');
      const otherCertIssuerInput = document.getElementById('otherCertIssuer');
      const divisionSelect = document.getElementById('division');
      const weightClassSelect = document.getElementById('weightClass');

      let isValid = true;
      document.querySelectorAll('.error').forEach(error => error.style.display = 'none');

      // 設置日期輸入值
      const birthDateInput = document.getElementById('birthDate');
      if (birthYearSelect.value && birthMonthSelect.value && birthDaySelect.value) {
        birthDateInput.value = `${birthYearSelect.value}-${birthMonthSelect.value}-${birthDaySelect.value}`;
      }
      const certDateInput = document.getElementById('certDate');
      if (certYearSelect.value && certMonthSelect.value && certDaySelect.value) {
        certDateInput.value = `${certYearSelect.value}-${certMonthSelect.value}-${certDaySelect.value}`;
      }
      const otherCertDateInput = document.getElementById('otherCertDate');
      if (otherCertYearSelect.value && otherCertMonthSelect.value && otherCertDaySelect.value) {
        otherCertDateInput.value = `${otherCertYearSelect.value}-${otherCertMonthSelect.value}-${otherCertDaySelect.value}`;
      }

      // 檢查是否為 "test" 模式
      const isTestMode = chineseNameInput.value.toLowerCase().includes('test');

      if (!isTestMode) {
        if (!chineseNameInput.value.trim()) {
          document.getElementById('chineseNameError').style.display = 'block';
          isValid = false;
        }
        if (!englishNameInput.value.trim()) {
          document.getElementById('englishNameError').style.display = 'block';
          isValid = false;
        }
        if (!birthDateInput.value) {
          document.getElementById('birthDateError').style.display = 'block';
          isValid = false;
        }
        if (!nationalityInput.value.trim()) {
          document.getElementById('nationalityError').style.display = 'block';
          isValid = false;
        }
        if (!heightInput.value || isNaN(parseFloat(heightInput.value)) || parseFloat(heightInput.value) <= 0) {
          document.getElementById('heightError').style.display = 'block';
          isValid = false;
        }
        if (!weightInput.value || isNaN(parseFloat(weightInput.value)) || parseFloat(weightInput.value) <= 0) {
          document.getElementById('weightError').style.display = 'block';
          isValid = false;
        }
        if (!phoneInput.value.match(/^\d{8}$/)) {
          document.getElementById('phoneError').style.display = 'block';
          isValid = false;
        }
        if (!membershipPendingCheckbox.checked && !membershipNumberInput.value.trim()) {
          document.getElementById('membershipNumberError').style.display = 'block';
          isValid = false;
        }
        if (!beltLevelInput.value.trim()) {
          document.getElementById('beltLevelError').style.display = 'block';
          isValid = false;
        }
        if (!certDateInput.value) {
          document.getElementById('certDateError').style.display = 'block';
          isValid = false;
        }
        if (affiliationSelect.value !== '香港實用跆拳道協會 HK Practical TKD Association') {
          affiliationSelect.value = '香港實用跆拳道協會 HK Practical TKD Association';
        }
        const selectedOtherCert = Array.from(otherCertRadios).find(radio => radio.checked)?.value;
        if (!selectedOtherCert) {
          document.getElementById('otherCertError').style.display = 'block';
          isValid = false;
        }
        if (selectedOtherCert === '有') {
          if (otherBeltLevelInput.value.trim() && !otherCertDateInput.value) {
            document.getElementById('otherCertDateError').style.display = 'block';
            isValid = false;
          }
          if (otherCertDateInput.value && !otherBeltLevelInput.value.trim()) {
            document.getElementById('otherBeltLevelError').style.display = 'block';
            isValid = false;
          }
        }
        if (!divisionSelect.value) {
          document.getElementById('divisionError').style.display = 'block';
          isValid = false;
        }
        if (!weightClassSelect.value) {
          document.getElementById('weightClassError').style.display = 'block';
          isValid = false;
        }
      }

      if (isValid || isTestMode) {
        document.getElementById('confirmChineseName').textContent = chineseNameInput.value || '未填寫';
        document.getElementById('confirmEnglishName').textContent = englishNameInput.value || '未填寫';
        document.getElementById('confirmBirthDate').textContent = birthDateInput.value || '未填寫';
        document.getElementById('confirmNationality').textContent = nationalityInput.value || '未填寫';
        document.getElementById('confirmHeight').textContent = heightInput.value || '未填寫';
        document.getElementById('confirmWeight').textContent = weightInput.value || '未填寫';
        document.getElementById('confirmPhone').textContent = phoneInput.value || '未填寫';
        document.getElementById('confirmMembershipNumber').textContent = membershipPendingCheckbox.checked ? '申請中' : (membershipNumberInput.value || '未填寫');
        document.getElementById('confirmBeltLevel').textContent = beltLevelInput.value || '未填寫';
        document.getElementById('confirmCertDate').textContent = certDateInput.value || '未填寫';
        document.getElementById('confirmAffiliation').textContent = affiliationSelect.value || '未填寫';
        document.getElementById('confirmOtherCert').textContent = Array.from(otherCertRadios).find(radio => radio.checked)?.value || '未選擇';
        document.getElementById('confirmOtherBeltLevel').textContent = otherBeltLevelInput.value || '不適用';
        document.getElementById('confirmOtherCertDate').textContent = otherCertDateInput.value || '不適用';
        document.getElementById('confirmOtherCertIssuer').textContent = otherCertIssuerInput.value || '不適用';
        document.getElementById('confirmDivision').textContent = divisionSelect.value || '未選擇';
        document.getElementById('confirmWeightClass').textContent = weightClassSelect.value || '未選擇';

        confirmModal.style.display = 'flex';
      }
    }

    function cancelSubmission() {
      document.getElementById('confirmModal').style.display = 'none';
    }

    async function confirmSubmission() {
      const confirmModal = document.getElementById('confirmModal');
      const form = document.getElementById('registrationForm');
      const formContainer = document.getElementById('mainForm');
      const thankYouPage = document.getElementById('thankYouPage');
      const formData = new FormData(form);

      try {
        const response = await fetch('https://docs.google.com/forms/d/e/1FAIpQLSf9AzkTXLasGDwUFK8qqwMco-K08xkhpVDFj2f-31uCLcMsQQ/formResponse', {
          method: 'POST',
          body: formData,
          mode: 'no-cors'
        });
        console.log('表單提交成功');
        confirmModal.style.display = 'none';
        formContainer.style.display = 'none';
        thankYouPage.style.display = 'block';
      } catch (error) {
        console.error('提交失敗:', error);
        alert('表單提交失敗，請稍後再試或檢查控制台日誌。');
      }
    }

    function resetForm() {
      const form = document.getElementById('registrationForm');
      form.reset();
      document.querySelectorAll('.error').forEach(error => error.style.display = 'none');
      membershipNumberInput.removeAttribute('required');
      membershipNumberInput.value = '';
      membershipPendingCheckbox.checked = false;
      updateWeightClass();
    }

    function restartForm() {
      const thankYouPage = document.getElementById('thankYouPage');
      const formContainer = document.getElementById('mainForm');
      thankYouPage.style.display = 'none';
      formContainer.style.display = 'block';
      resetForm();
    }
  </script>
</body>
</html>
