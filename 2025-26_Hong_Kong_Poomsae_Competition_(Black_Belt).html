<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>2025-26年度 香港跆拳道品勢比賽(黑帶組) | 2025-26 Hong Kong Poomsae Competition (Black Belt)</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Noto Sans TC',Arial,sans-serif;max-width:900px;margin:1rem auto;padding:1rem;background:linear-gradient(135deg,#e6f0fa,#d9e6f5);color:#2d3748;line-height:1.7;min-height:100vh}
    .form-container{background:#fff;padding:2rem;border-radius:1.2rem;box-shadow:0 8px 24px rgba(0,0,0,.12);transition:transform .3s,box-shadow .3s}
    .form-container:hover{transform:translateY(-4px);box-shadow:0 12px 32px rgba(0,0,0,.18)}
    .form-header{text-align:center;margin-bottom:2.5rem;padding-bottom:1.5rem;border-bottom:2px solid #edf2f7}
    .form-header h1{font-size:1.8rem;font-weight:700;color:#1a202c;margin:0}
    .form-header h2{font-size:1.1rem;font-weight:500;color:#718096;margin-top:.5rem}
    .progress-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;position:relative;height:40px}
    .progress-bar::before{content:'';position:absolute;top:50%;left:0;right:0;height:4px;background:#e2e8f0;transform:translateY(-50%);z-index:1;border-radius:2px}
    .progress-line-fill{position:absolute;top:50%;left:0;height:4px;background:linear-gradient(90deg,#3182ce,#63b3ed);transform:translateY(-50%);z-index:1;transition:width .5s ease-in-out;border-radius:2px;box-shadow:0 0 6px rgba(49,130,206,.4)}
    .progress-step{width:40px;height:40px;border-radius:50%;background:#e2e8f0;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:1rem;color:#4a5568;position:relative;z-index:2;transition:all .3s;box-shadow:0 2px 4px rgba(0,0,0,.1)}
    .progress-step.active{background:linear-gradient(45deg,#3182ce,#63b3ed);color:#fff;transform:scale(1.1);box-shadow:0 4px 12px rgba(49,130,206,.4)}
    .progress-step.completed{background:linear-gradient(45deg,#3182ce,#63b3ed);color:#fff;box-shadow:0 3px 10px rgba(49,130,206,.3)}
    .step{display:none}
    .step.active{display:block}
    .form-group{margin-bottom:1.5rem;padding:1.2rem;border-radius:1rem;background:#f7fafc;transition:background .3s,transform .2s;box-shadow:0 2px 8px rgba(0,0,0,.05)}
    .form-group:hover{background:#edf2f7;transform:translateY(-2px)}
    .conditional{margin-top:1rem;padding-left:1.5rem;border-left:4px solid #3182ce;display:none;background:#f8fbff;border-radius:0 .8rem .8rem .8rem}
    .conditional.show{display:block;animation:fadeIn .4s}
    @keyframes fadeIn{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}
    label{display:block;margin-bottom:.5rem;font-weight:600;font-size:1rem;color:#2d3748}
    input,select,button{width:100%;padding:.8rem;border:1px solid #e2e8f0;border-radius:.6rem;box-sizing:border-box;font-size:1rem;background:#fff;transition:all .3s;height:2.8rem}
    input:focus,select:focus{outline:none;border-color:#3182ce;box-shadow:0 0 6px rgba(49,130,206,.4);background:#f8fbff}
    .date-group{display:flex;align-items:center;gap:.5rem}
    .date-group select{width:8rem}
    .date-group span{font-size:1rem;color:#2d3748}
    .category-group{display:flex;gap:1.5rem;flex-wrap:wrap;padding:.5rem 0}
    .category-group label{display:flex;align-items:center;font-weight:500;cursor:pointer;font-size:1rem}
    .category-group input[type="checkbox"],.category-group input[type="radio"]{width:18px;height:18px;margin-right:.8rem;cursor:pointer}
    .copy-group{display:flex;align-items:center;gap:1rem;flex-wrap:wrap}
    .copy-group input[type="text"],.copy-group input[type="tel"]{flex:1;min-width:200px}
    .copy-group label{display:flex;align-items:center;white-space:nowrap;font-weight:500;font-size:1rem;cursor:pointer}
    .copy-group input[type="checkbox"]{width:18px;height:18px;margin-right:.5rem}
    .error{color:#e53e3e;font-size:.85rem;margin-top:.4rem;display:none}
    .navigation{display:flex;justify-content:space-between;margin-top:2rem;gap:1rem}
    .navigation button{padding:.8rem 1.5rem;border:none;border-radius:.6rem;cursor:pointer;font-weight:600;min-height:44px;flex:1;max-width:45%}
    .nav-prev{background:#edf2f7;color:#718096}
    .nav-prev:hover{background:#e2e8f0}
    .nav-next,#submitBtn{background:linear-gradient(90deg,#3182ce,#2b6cb0);color:#fff}
    .nav-next:hover,#submitBtn:hover{background:linear-gradient(90deg,#2b6cb0,#2c5282)}
    #thankYouPage{display:none;background:#fff;padding:3rem 2rem;border-radius:1.2rem;box-shadow:0 8px 24px rgba(0,0,0,.12);text-align:center;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:500px;z-index:9999}
    #thankYouPage h2{font-size:1.8rem;color:#1a202c;margin-bottom:1rem}
    #thankYouPage p{font-size:1.1rem;color:#38a169;margin:1rem 0}
    button.return-button{padding:.8rem 1.5rem;border:none;border-radius:.6rem;cursor:pointer;background:linear-gradient(90deg,#3182ce,#2b6cb0);color:#fff;font-size:1rem}
    button.return-button:hover{background:linear-gradient(90deg,#2b6cb0,#2c5282);transform:translateY(-2px)}
    .required-star{color:#e53e3e}
    @media(max-width:600px){
      .date-group select{width:6.5rem}
      .form-group{padding:.9rem}
      .navigation{gap:.6rem}
    }
  </style>
</head>
<body>

<div class="form-container" id="mainForm">
  <div class="form-header">
    <h1>2025-26年度 香港跆拳道品勢比賽(黑帶組)</h1>
    <h1>2025-26 Hong Kong Poomsae Competition (Black Belt)</h1>
    <h2>報名表</h2>
  </div>

  <div class="progress-bar">
    <div class="progress-line-fill" id="progressLineFill"></div>
    <div class="progress-step active" data-step="1">1</div>
    <div class="progress-step" data-step="2">2</div>
    <div class="progress-step" data-step="3">3</div>
    <div class="progress-step" data-step="4">4</div>
  </div>

  <form id="registrationForm">
    <!-- 步驟一：個人資料 -->
    <div class="step active" data-step="1">
      <h3>步驟一：個人資料</h3>

      <div class="form-group">
        <label>中文姓名 <span class="required-star">*</span></label>
        <input type="text" id="chineseName" name="entry.1714227241" placeholder="如沒有請填寫英文姓名" required>
        <span class="error" id="chineseNameError">請輸入中文姓名或英文姓名</span>
      </div>

      <div class="form-group">
        <label>英文姓名 <span class="required-star">*</span></label>
        <input type="text" id="englishName" name="entry.1739837016" placeholder="請以大寫字母填寫" required oninput="this.value=this.value.toUpperCase()">
        <span class="error" id="englishNameError">請輸入英文姓名</span>
      </div>

      <div class="form-group">
        <label>出生日期 <span class="required-star">*</span></label>
        <div class="date-group">
          <select id="birthYear" required><option value="">年</option></select>
          <span>/</span>
          <select id="birthMonth" required><option value="">月</option></select>
          <span>/</span>
          <select id="birthDay" required><option value="">日</option></select>
        </div>
        <input type="hidden" id="birthDate" name="entry.69039678">
        <span class="error" id="birthDateError">請選擇出生日期</span>
      </div>

      <div class="form-group">
        <label>性別 <span class="required-star">*</span></label>
        <div class="category-group">
          <label><input type="radio" name="entry.71284989" value="男 Male" required> 男 Male</label>
          <label><input type="radio" name="entry.71284989" value="女 Female"> 女 Female</label>
        </div>
        <span class="error" id="genderError">請選擇性別</span>
      </div>

      <div class="form-group">
        <label>國籍 <span class="required-star">*</span></label>
        <input type="text" id="nationality" name="entry.269558714" required>
        <span class="error" id="nationalityError">請輸入國籍</span>
      </div>

      <div class="form-group">
        <label>聯絡電話 <span class="required-star">*</span></label>
        <input type="tel" id="phone" name="entry.1045318375" pattern="\d{8}" required>
        <span class="error" id="phoneError">請輸入8位數字電話</span>
      </div>

      <div class="form-group">
        <label>緊急聯絡人姓名 <span class="required-star">*</span></label>
        <input type="text" id="emergencyContact" name="entry.1820097193" required>
        <span class="error" id="emergencyContactError">請輸入緊急聯絡人姓名</span>
      </div>

      <div class="form-group">
        <label>緊急聯絡人電話 <span class="required-star">*</span></label>
        <div class="copy-group">
          <input type="tel" id="emergencyPhone" name="entry.274850195" pattern="\d{8}" required>
          <label><input type="checkbox" id="copyPhone"> 同上</label>
        </div>
        <span class="error" id="emergencyPhoneError">請輸入8位數字電話</span>
      </div>

      <div class="navigation">
        <button type="button" class="nav-prev" disabled>上一步</button>
        <button type="button" class="nav-next" onclick="nextStep()">下一步</button>
      </div>
    </div>

    <!-- 步驟二：級別資料 -->
    <div class="step" data-step="2">
      <h3>步驟二：級別資料</h3>

      <div class="form-group">
        <label>屬會名稱 <span class="required-star">*</span></label>
        <input list="affiliations" id="affiliation" name="entry.1597491054" required placeholder="請輸入或選擇屬會名稱">
        <datalist id="affiliations">
          <option value="香港實用跆拳道協會 HK Practical TKD Association">
          <option value="香港仔跆拳道會 Aberdeen TKD Club">
          <option value="技擊跆拳道會 Advanced TKD Association">
          <option value="躍駿跆拳道會 Attack TKD Association">
          <option value="青雲跆拳道會 Ching Wan TKD Association">
          <option value="精英跆拳道會 Ching Ying TKD Union">
          <option value="金柏跆拳道協會 Combat TKD Association">
          <option value="香港跆拳道東龍會 Eastern Dragon TKD Federation HK">
          <option value="勵志跆拳道總會 Encouragement TKD Association">
          <option value="香港智道跆拳總會 HK Chido TKD Association">
          <option value="香港啟聯跆拳道協會 HK Kai Luen TKD Association">
          <option value="香港尼泊爾跆拳道會 HK Nepalese TKD Club">
          <option value="香港跆拳道振武館 HK TKD Chun Mo Kwan">
          <option value="香港跆拳道勵進會 HK TKD Action Association">
          <option value="香港跆拳道勵誠會 HK TKD Active Association">
          <option value="香港跆拳道勵輝會 HK TKD Actual Association">
          <option value="香港中道跆拳道會 HK Chong Do TKD Association">
          <option value="香港跆拳道青濤館 HK TKD Chung Do Kwan">
          <option value="香港跆拳道正道館 HK TKD Jung Do Kwan">
          <option value="香港跆拳道正心館 HK TKD Jung Sim Kwan">
          <option value="香港聯盟跆拳道協會 HK United TKD Association">
          <option value="跆拳道明道會 TKD Bright Way Association">
          <option value="漢道跆拳道館 Hon Do TKD Kwan">
          <option value="國際跆拳道香港總會 International TKD HK Association">
          <option value="韓國跆拳道青道館 Korea TKD Cheung Do Kwan">
          <option value="樂華跆拳道會 Lok Wah TKD Club">
          <option value="銘英跆拳道會 Main Pioneer TKD Association">
          <option value="跆拳道武德會 Moo Duk TKD Hae">
          <option value="伍華跆拳道會 Ng Wah TKD Club">
          <option value="毅武聯盟跆拳道 Ngai Mo Alliance TKD">
          <option value="香港警察跆拳道會 HK Police TKD Club">
          <option value="香港跆拳道國藝會 Potential TKD HK Association">
          <option value="跆拳道吾道會體育館 TKD Oh Do Hae Gymnasium">
          <option value="香港胡氏跆拳道會 Wu’s TKD HK Association">
          <option value="正武會跆拳道協會 Zheng Wu TKD Association">
          <option value="香港發景跆拳道會 Hong Kong Greatview TKD Club">
          <option value="香港跆拳道柏毅會 Hong Kong TKD Pak Ngai Association">
          <option value="香港跆拳道嚴濤會 Hong Kong TKD Uhm Do Club">
          <option value="威格跆拳道會 Warrior TKD Club">
          <option value="金道跆拳道聯盟 The Kimdo TKD Federation">
          <option value="金道一跆拳道館 Kim Do Yi TKD Kwan">
          <option value="樂武跆拳道會 Cheerful TKD Association Limited">
          <option value="世紀跆拳道會 H.K. Taekwondo Cosmopolitan Club">
          <option value="燊．跆拳道館 Sun Taekwondo Club">
          <option value="香港進和跆拳道會 Hong Kong Chun Wo Taekwondo Association">
          <option value="香港賢薈跆拳道會 Hong Kong Ultimate Taekwondo Club">
        </datalist>
        <span class="error" id="affiliationError">請選擇或輸入屬會名稱</span>
      </div>

      <div class="form-group">
        <label>段證編號 <span class="required-star">*</span></label>
        <div class="copy-group">
          <input type="text" id="danNumber" name="entry.629960054" required>
          <label><input type="checkbox" id="noDan"> 未有段證</label>
        </div>
        <span class="error" id="danNumberError">請輸入段證編號或勾選「未有段證」</span>
      </div>

      <div class="form-group">
        <label>段證申請日期（如申請中請填申請當日日期）<span class="required-star">*</span></label>
        <div class="date-group">
          <select id="danYear" required><option value="">年</option></select>
          <span>/</span>
          <select id="danMonth" required><option value="">月</option></select>
          <span>/</span>
          <select id="danDay" required><option value="">日</option></select>
        </div>
        <input type="hidden" id="danDate" name="entry.1924363147">
        <span class="error" id="danDateError">請選擇段證申請日期</span>
      </div>

      <div class="form-group">
        <label>現有級別 <span class="required-star">*</span></label>
        <select id="currentDan" name="entry.703788026" required>
          <option value="">請選擇級別</option>
          <option value="黑帶一段 1 Dan">黑帶一段 1 Dan</option>
          <option value="黑帶二段 2 Dan">黑帶二段 2 Dan</option>
          <option value="黑帶三段 3 Dan">黑帶三段 3 Dan</option>
          <option value="黑帶四段 4 Dan">黑帶四段 4 Dan</option>
          <option value="黑帶五段 5 Dan">黑帶五段 5 Dan</option>
          <option value="黑帶六段 6 Dan">黑帶六段 6 Dan</option>
          <option value="黑帶七段 7 Dan">黑帶七段 7 Dan</option>
          <option value="黑帶八段 8 Dan">黑帶八段 8 Dan</option>
          <option value="黑帶九段 9 Dan">黑帶九段 9 Dan</option>
          <option value="黑帶一品 1 Poom">黑帶一品 1 Poom</option>
          <option value="黑帶二品 2 Poom">黑帶二品 2 Poom</option>
          <option value="黑帶三品 3 Poom">黑帶三品 3 Poom</option>
        </select>
        <span class="error" id="currentDanError">請選擇現有級別</span>
      </div>

      <div class="navigation">
        <button type="button" class="nav-prev" onclick="prevStep()">上一步</button>
        <button type="button" class="nav-next" onclick="nextStep()">下一步</button>
      </div>
    </div>

    <!-- 步驟三：比賽資料 -->
    <div class="step" data-step="3">
      <h3>步驟三：比賽資料</h3>

      <div class="form-group">
        <label>參加項目（可多選）<span class="required-star">*</span></label>
        <div class="category-group">
          <label><input type="checkbox" id="eventIndividual"> 個人</label>
          <label><input type="checkbox" id="eventPair"> 混雙</label>
          <label><input type="checkbox" id="eventTeam"> 團體</label>
          <!-- 真正送出的隱藏欄位 -->
          <input type="hidden" id="eventField" name="entry.1666612578" value="">
        </div>
      </div>

      <div class="conditional" id="individualSection">
        <div class="form-group">
          <label>個人組別（自動帶入）</label>
          <select id="individualDivision" name="entry.1084612574"></select>
        </div>
      </div>

      <div class="conditional" id="pairSection">
        <div class="form-group">
          <label>混雙組別（自動帶入）</label>
          <select id="pairDivision" name="entry.1721761818"></select>
        </div>
        <div class="form-group">
          <label>混雙隊員姓名（中文）<span class="required-star">*</span></label>
          <input type="text" id="pairPartner" name="entry.1921234097">
          <span class="error" id="pairPartnerError">請輸入混雙隊員姓名</span>
        </div>
      </div>

      <div class="conditional" id="teamSection">
        <div class="form-group">
          <label>團體組別（自動帶入）</label>
          <select id="teamDivision" name="entry.1294289670"></select>
        </div>
        <div class="form-group">
          <label>團體隊員姓名1（中文）<span class="required-star">*</span></label>
          <input type="text" id="teamMember1" name="entry.228238123">
          <span class="error" id="teamMember1Error">請輸入團體隊員1姓名</span>
        </div>
        <div class="form-group">
          <label>團體隊員姓名2（中文）<span class="required-star">*</span></label>
          <input type="text" id="teamMember2" name="entry.1642921107">
          <span class="error" id="teamMember2Error">請輸入團體隊員2姓名</span>
        </div>
      </div>

      <div class="navigation">
        <button type="button" class="nav-prev" onclick="prevStep()">上一步</button>
        <button type="button" class="nav-next" onclick="nextStep()">下一步</button>
      </div>
    </div>

    <!-- 步驟四：確認及提交 -->
    <div class="step" data-step="4">
      <h3>步驟四：確認及提交</h3>
      <div class="confirm-summary" id="finalSummary" style="background:#f8fbff;padding:1.5rem;border-radius:1rem;border-left:5px solid #3182ce;line-height:1.9"></div>
      <div class="navigation">
        <button type="button" class="nav-prev" onclick="prevStep()">上一步</button>
        <button type="button" id="submitBtn" onclick="submitForm()">提交表單</button>
      </div>
    </div>
  </form>
</div>

<!-- 感謝頁 -->
<div id="thankYouPage">
  <h2>感謝您的報名！</h2>
  <p>我們已經成功收到您的資料。</p>
  <p>教練將會盡快與您聯繫確認細節。</p>
  <button class="return-button" onclick="location.reload()">重新報名</button>
</div>

<script>
  let currentStep = 1;
  const totalSteps = 4;

  const poomsaeDivisions = {
    individual: {
      male: {
        "2014-2015": "10歲 至 11歲 PI1M 個人男品組 Age: 10 to 11 (2014 - 2015年出生者) - 太極六章、高麗",
        "2011-2013": "12歲 至 14歲 PI2M 個人男品組 Age: 12 to 14 (2011 - 2013年出生者) - 太極七章、高麗",
        "2008-2010": "15歲 至 17歲 DI1M 個人男黑組 Age: 15 to 17 (2008 - 2010年出生者) - 高麗、太極七章/八章",
        "1995-2007": "18歲 至 30歲 DI2M 個人男黑組 Age: 18 to 30 (1995 - 2007年出生者) - 太白、高麗/金剛",
        "1985-1994": "31歲 至 40歲 DI3M 個人男黑組 Age: 31 to 40 (1985 - 1994年出生者) - 太白、高麗/金剛",
        "1975-1984": "41歲 至 50歲 DI4M 個人男黑組 Age: 41 to 50 (1975 - 1984年出生者) - 地跆、十進/平原",
        "default": "51歲或以上 DI5M 個人男黑組 Age: 51 or above (1974年或之前出生者) - 地跆、十進/平原"
      },
      female: {
        "2014-2015": "10歲 至 11歲 PI1F 個人女品組 Age: 10 to 11 (2014 - 2015年出生者) - 太極六章、高麗",
        "2011-2013": "12歲 至 14歲 PI2F 個人女品組 Age: 12 to 14 (2011 - 2013年出生者) - 太極七章、高麗",
        "2008-2010": "15歲 至 17歲 DI1F 個人女黑組 Age: 15 to 17 (2008 - 2010年出生者) - 高麗、太極七章/八章",
        "1995-2007": "18歲 至 30歲 DI2F 個人女黑組 Age: 18 to 30 (1995 - 2007年出生者) - 太白、高麗/金剛",
        "1985-1994": "31歲 至 40歲 DI3F 個人女黑組 Age: 31 to 40 (1985 - 1994年出生者) - 太白、高麗/金剛",
        "1975-1984": "41歲 至 50歲 DI4F 個人女黑組 Age: 41 to 50 (1975 - 1984年出生者) - 地跆、十進/平原",
        "default": "51歲或以上 DI5F 個人女黑組 Age: 51 or above (1974年或之前出生者) - 地跆、十進/平原"
      }
    },
    pair: {
      "2011-2013": "12歲 至 14歲 PP2 男女雙人品組 Age: 12 to 14 (2011 - 2013年出生者) - 太極七章、高麗",
      "2008-2010": "15歲 至 17歲 DP1 男女雙人品組 Age: 15 to 17 (2008 - 2010年出生者) - 高麗、太極七章/八章",
      "1995-2007": "18歲 至 30歲 DP2 男女雙人品組 Age: 18 to 30 (1995 - 2007年出生者) - 太白、高麗/金剛",
      "1985-1994": "31歲 至 40歲 DP3 男女雙人品組 Age: 31 to 40 (1985 - 1994年出生者) - 太白、高麗/金剛",
      "1975-1984": "41歲 至 50歲 DP4 男女雙人品組 Age: 41 to 50 (1975 - 1984年出生者) - 地跆、十進/平原",
      "default": "51歲或以上 DP5 男女雙人品組 Age: 51 or above (1974年或之前出生者) - 地跆、十進/平原"
    },
    team: {
      male: {
        "2011-2013": "12歲 至 14歲 PT2M 男子團體品組 Age: 12 to 14 (2011 - 2013年出生者) - 太極七章、高麗",
        "2008-2010": "15歲 至 17歲 DT1M 男子團體黑帶組 Age: 15 to 17 (2008 - 2010年出生者) - 高麗、太極七章/八章",
        "1995-2007": "18歲 至 30歲 DT2M 男子團體黑帶組 Age: 18 to 30 (1995 - 2007年出生者) - 太白、高麗/金剛",
        "1985-1994": "31歲 至 40歲 DT3M 男子團體黑帶組 Age: 31 to 40 (1985 - 1994年出生者) - 太白、高麗/金剛",
        "1975-1984": "41歲 至 50歲 DT4M 男子團體黑帶組 Age: 41 to 50 (1975 - 1984年出生者) - 地跆、十進/平原",
        "default": "51歲或以上 DT5M 男子團體黑帶組 Age: 51 or above (1974年或之前出生者) - 地跆、十進/平原"
      },
      female: {
        "2011-2013": "12歲 至 14歲 PT2F 女子團體品組 Age: 12 to 14 (2011 - 2013年出生者) - 太極七章、高麗",
        "2008-2010": "15歲 至 17歲 DT1F 女子團體黑帶組 Age: 15 to 17 (2008 - 2010年出生者) - 高麗、太極七章/八章",
        "1995-2007": "18歲 至 30歲 DT2F 女子團體黑帶組 Age: 18 to 30 (1995 - 2007年出生者) - 太白、高麗/金剛",
        "1985-1994": "31歲 至 40歲 DT3F 女子團體黑帶組 Age: 31 to 40 (1985 - 1994年出生者) - 太白、高麗/金剛",
        "1975-1984": "41歲 至 50歲 DT4F 女子團體黑帶組 Age: 41 to 50 (1975 - 1984年出生者) - 地跆、十進/平原",
        "default": "51歲或以上 DT5F 女子團體黑帶組 Age: 51 or above (1974年或之前出生者) - 地跆、十進/平原"
      }
    }
  };

  function updateProgress() {
    const steps = document.querySelectorAll('.progress-step');
    const firstStep = steps[0].offsetLeft;
    const lastStep = steps[steps.length-1].offsetLeft;
    const totalDistance = lastStep - firstStep;
    const progress = ((currentStep - 1) / (totalSteps - 1)) * totalDistance;
    document.getElementById('progressLineFill').style.width = progress + 'px';

    steps.forEach((step, i) => {
      const n = i + 1;
      step.classList.toggle('active', n === currentStep);
      step.classList.toggle('completed', n < currentStep);
    });

    document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
    document.querySelector(`.step[data-step="${currentStep}"]`).classList.add('active');
    document.querySelector('.nav-prev').disabled = currentStep === 1;
    if (currentStep === 4) updateFinalSummary();
  }

  function nextStep() { if (validateStep(currentStep)) { currentStep++; updateProgress(); toggleConditionalSections(); updateAllDivisions(); } }
  function prevStep() { currentStep--; updateProgress(); toggleConditionalSections(); updateAllDivisions(); }

  function getAgeGroup(year) {
    if (year >= 2014 && year <= 2015) return "2014-2015";
    if (year >= 2011 && year <= 2013) return "2011-2013";
    if (year >= 2008 && year <= 2010) return "2008-2010";
    if (year >= 1995 && year <= 2007) return "1995-2007";
    if (year >= 1985 && year <= 1994) return "1985-1994";
    if (year >= 1975 && year <= 1984) return "1975-1984";
    return "default";
  }

  function updateEventField() {
    const events = [];
    if (document.getElementById('eventIndividual').checked) events.push('個人');
    if (document.getElementById('eventPair').checked) events.push('混雙');
    if (document.getElementById('eventTeam').checked) events.push('團體');
    document.getElementById('eventField').value = events.length ? events.join('、') : '無';
  }

  function updateAllDivisions() {
    const year = parseInt(document.getElementById('birthYear').value);
    const gender = document.querySelector('input[name="entry.71284989"]:checked')?.value;
    if (!year || !gender) return;
    const isMale = gender.includes('男');
    const ageKey = getAgeGroup(year);

    // 個人
    const indDiv = isMale ? poomsaeDivisions.individual.male[ageKey] || poomsaeDivisions.individual.male.default
                          : poomsaeDivisions.individual.female[ageKey] || poomsaeDivisions.individual.female.default;
    document.getElementById('individualDivision').innerHTML = `<option value="${indDiv}">${indDiv}</option>`;

    // 混雙
    if (ageKey !== "2014-2015") {
      const pairDiv = poomsaeDivisions.pair[ageKey] || poomsaeDivisions.pair.default;
      document.getElementById('pairDivision').innerHTML = `<option value="${pairDiv}">${pairDiv}</option>`;
    } else {
      document.getElementById('pairDivision').innerHTML = '<option value="">此年齡段無混雙組別</option>';
    }

    // 團體
    if (ageKey !== "2014-2015") {
      const teamDiv = isMale ? poomsaeDivisions.team.male[ageKey] || poomsaeDivisions.team.male.default
                             : poomsaeDivisions.team.female[ageKey] || poomsaeDivisions.team.female.default;
      document.getElementById('teamDivision').innerHTML = `<option value="${teamDiv}">${teamDiv}</option>`;
    } else {
      document.getElementById('teamDivision').innerHTML = '<option value="">此年齡段無團體組別</option>';
    }

    if (currentStep === 4) updateFinalSummary();
  }

  function toggleConditionalSections() {
    document.getElementById('individualSection').classList.toggle('show', document.getElementById('eventIndividual').checked);
    document.getElementById('pairSection').classList.toggle('show', document.getElementById('eventPair').checked);
    document.getElementById('teamSection').classList.toggle('show', document.getElementById('eventTeam').checked);
    updateEventField();
  }

  function validateStep(step) {
    const name = document.getElementById('chineseName').value.toLowerCase();
    if (name.includes('test')) return true;

    let valid = true;
    document.querySelectorAll('.error').forEach(e => e.style.display = 'none');

    if (step === 1) {
      if (!document.getElementById('chineseName').value.trim()) { document.getElementById('chineseNameError').style.display = 'block'; valid = false; }
      if (!document.getElementById('englishName').value.trim()) { document.getElementById('englishNameError').style.display = 'block'; valid = false; }
      if (!document.getElementById('birthDate').value) { document.getElementById('birthDateError').style.display = 'block'; valid = false; }
      if (!document.querySelector('input[name="entry.71284989"]:checked')) { document.getElementById('genderError').style.display = 'block'; valid = false; }
      if (!document.getElementById('nationality').value.trim()) { document.getElementById('nationalityError').style.display = 'block'; valid = false; }
      if (!document.getElementById('phone').value.match(/^\d{8}$/)) { document.getElementById('phoneError').style.display = 'block'; valid = false; }
      if (!document.getElementById('emergencyContact').value.trim()) { document.getElementById('emergencyContactError').style.display = 'block'; valid = false; }
      if (!document.getElementById('emergencyPhone').value.match(/^\d{8}$/)) { document.getElementById('emergencyPhoneError').style.display = 'block'; valid = false; }
    }
    if (step === 2) {
      if (!document.getElementById('affiliation').value.trim()) { document.getElementById('affiliationError').style.display = 'block'; valid = false; }
      if (!document.getElementById('noDan').checked && !document.getElementById('danNumber').value.trim()) { document.getElementById('danNumberError').style.display = 'block'; valid = false; }
      if (!document.getElementById('danDate').value) { document.getElementById('danDateError').style.display = 'block'; valid = false; }
      if (!document.getElementById('currentDan').value) { document.getElementById('currentDanError').style.display = 'block'; valid = false; }
    }
    if (step === 3) {
      const hasIndividual = document.getElementById('eventIndividual').checked;
      const hasPair = document.getElementById('eventPair').checked;
      const hasTeam = document.getElementById('eventTeam').checked;
      if (!hasIndividual && !hasPair && !hasTeam) { alert('請至少選擇一個參加項目'); valid = false; }
      if (hasPair && !document.getElementById('pairPartner').value.trim()) { document.getElementById('pairPartnerError').style.display = 'block'; valid = false; }
      if (hasTeam && (!document.getElementById('teamMember1').value.trim() || !document.getElementById('teamMember2').value.trim())) {
        if (!document.getElementById('teamMember1').value.trim()) document.getElementById('teamMember1Error').style.display = 'block';
        if (!document.getElementById('teamMember2').value.trim()) document.getElementById('teamMember2Error').style.display = 'block';
        valid = false;
      }
    }
    return valid;
  }

  function updateFinalSummary() {
    const events = [];
    if (document.getElementById('eventIndividual').checked) events.push('個人');
    if (document.getElementById('eventPair').checked) events.push('混雙');
    if (document.getElementById('eventTeam').checked) events.push('團體');

    let html = `
      <p><strong>中文姓名：</strong> ${document.getElementById('chineseName').value || '未填'}</p>
      <p><strong>英文姓名：</strong> ${document.getElementById('englishName').value || '未填'}</p>
      <p><strong>出生日期：</strong> ${document.getElementById('birthDate').value || '未選'}</p>
      <p><strong>性別：</strong> ${document.querySelector('input[name="entry.71284989"]:checked')?.value || '未選'}</p>
      <p><strong>國籍：</strong> ${document.getElementById('nationality').value || '未填'}</p>
      <p><strong>聯絡電話：</strong> ${document.getElementById('phone').value || '未填'}</p>
      <p><strong>緊急聯絡人：</strong> ${document.getElementById('emergencyContact').value || '未填'}（${document.getElementById('emergencyPhone').value || '未填'}）</p>
      <p><strong>屬會名稱：</strong> ${document.getElementById('affiliation').value || '未選'}</p>
      <p><strong>段證編號：</strong> ${document.getElementById('noDan').checked ? '未有段證' : (document.getElementById('danNumber').value || '未填')}</p>
      <p><strong>段證申請日期：</strong> ${document.getElementById('danDate').value || '未選'}</p>
      <p><strong>現有級別：</strong> ${document.getElementById('currentDan').value || '未選'}</p>
      <p><strong>參加項目：</strong> ${events.length ? events.join('、') : '未選擇'}</p>`;

    if (document.getElementById('eventIndividual').checked) {
      html += `<p><strong>　└ 個人組別：</strong> ${document.getElementById('individualDivision').value || '尚未產生'}</p>`;
    }
    if (document.getElementById('eventPair').checked) {
      html += `<p><strong>　└ 混雙組別：</strong> ${document.getElementById('pairDivision').value || '尚未產生'}</p>
               <p><strong>　　　└ 混雙隊員：</strong> ${document.getElementById('pairPartner').value || '未填'}</p>`;
    }
    if (document.getElementById('eventTeam').checked) {
      html += `<p><strong>　└ 團體組別：</strong> ${document.getElementById('teamDivision').value || '尚未產生'}</p>
               <p><strong>　　　└ 團體隊員1：</strong> ${document.getElementById('teamMember1').value || '未填'}</p>
               <p><strong>　　　└ 團體隊員2：</strong> ${document.getElementById('teamMember2').value || '未填'}</p>`;
    }

    document.getElementById('finalSummary').innerHTML = html;
  }

  function submitForm() {
    if (!validateStep(4)) return;
    updateEventField(); // 確保參加項目有正確送出

    const formData = new FormData(document.getElementById('registrationForm'));
    formData.set('entry.69039678', document.getElementById('birthDate').value);
    formData.set('entry.1924363147', document.getElementById('danDate').value);
    if (document.getElementById('noDan').checked) formData.set('entry.629960054', '未有段證');

    fetch('https://docs.google.com/forms/d/e/1FAIpQLSedVdHN65Sx7p9Mz8-ZxtY9w88kEUar5U2Q5GnwPODfxifpYw/formResponse', {
      method: 'POST',
      mode: 'no-cors',
      body: formData
    });

    document.getElementById('mainForm').style.display = 'none';
    document.getElementById('thankYouPage').style.display = 'block';
  }

  function populateDate(selectYear, selectMonth, selectDay, hiddenInput, minYear = 1940) {
    const yearSel = document.getElementById(selectYear);
    const monthSel = document.getElementById(selectMonth);
    const daySel = document.getElementById(selectDay);
    const hidden = document.getElementById(hiddenInput);
    const maxYear = selectYear === 'birthYear' ? 2015 : new Date().getFullYear();

    for (let y = maxYear; y >= minYear; y--) {
      let opt = document.createElement('option'); opt.value = y; opt.text = y;
      yearSel.appendChild(opt);
    }
    for (let m = 1; m <= 12; m++) {
      let opt = document.createElement('option'); opt.value = m; opt.text = m;
      monthSel.appendChild(opt);
    }

    function updateDays() {
      const year = parseInt(yearSel.value);
      const month = parseInt(monthSel.value);
      if (!year || !month) { daySel.innerHTML = '<option value="">日</option>'; return; }
      const daysInMonth = new Date(year, month, 0).getDate();
      const prevDay = daySel.value;
      daySel.innerHTML = '<option value="">日</option>';
      for (let d = 1; d <= daysInMonth; d++) {
        let opt = document.createElement('option'); opt.value = d; opt.text = d;
        daySel.appendChild(opt);
      }
      if (prevDay && prevDay <= daysInMonth) daySel.value = prevDay;
      if (year && month && daySel.value) hidden.value = `${year}-${String(month).padStart(2,'0')}-${String(daySel.value).padStart(2,'0')}`;
    }
    yearSel.onchange = monthSel.onchange = daySel.onchange = updateDays;
    updateDays();
  }

  document.addEventListener('DOMContentLoaded', () => {
    updateProgress();
    populateDate('birthYear', 'birthMonth', 'birthDay', 'birthDate', 1940);
    populateDate('danYear', 'danMonth', 'danDay', 'danDate', 1980);

    document.getElementById('noDan').onchange = function() {
      const danInput = document.getElementById('danNumber');
      danInput.disabled = this.checked;
      danInput.required = !this.checked;
      if (this.checked) danInput.value = '';
    };

    document.getElementById('copyPhone').onchange = function() {
      if (this.checked) document.getElementById('emergencyPhone').value = document.getElementById('phone').value;
    };
    document.getElementById('phone').oninput = function() {
      if (document.getElementById('copyPhone').checked) document.getElementById('emergencyPhone').value = this.value;
    };

    ['eventIndividual', 'eventPair', 'eventTeam'].forEach(id => {
      document.getElementById(id).onclick = function() {
        const year = parseInt(document.getElementById('birthYear').value) || 0;
        if (getAgeGroup(year) === "2014-2015" && (this.id === "eventPair" || this.id === "eventTeam") && this.checked) {
          this.checked = false;
          alert("10-11歲（2014-2015年出生）不可參加混雙或團體項目");
        }
        toggleConditionalSections();
        if (currentStep === 4) updateFinalSummary();
      };
    });

    document.getElementById('birthYear').onchange = () => { updateAllDivisions(); if (currentStep === 4) updateFinalSummary(); };
    document.querySelectorAll('input[name="entry.71284989"]').forEach(r => r.onchange = () => { updateAllDivisions(); if (currentStep === 4) updateFinalSummary(); });

    updateAllDivisions();
  });
</script>
</body>
</html>
