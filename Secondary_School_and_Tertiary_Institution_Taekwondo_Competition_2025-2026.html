<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>香港學界跆拳道比賽2025-2026(中學及大專組) Secondary School and Tertiary Institution Taekwondo Competition 2025-2026</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Noto Sans TC', Arial, sans-serif;
      max-width: 900px;
      margin: 1rem auto;
      padding: 1rem;
      background: linear-gradient(135deg, #e6f0fa, #d9e6f5);
      color: #2d3748;
      line-height: 1.7;
      min-height: 100vh;
    }
    .form-container {
      background: #ffffff;
      padding: 2rem;
      border-radius: 1.2rem;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .form-container:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.18);
    }
    .form-header {
      text-align: center;
      margin-bottom: 2.5rem;
      padding-bottom: 1.5rem;
      border-bottom: 2px solid #edf2f7;
    }
    .form-header h1 {
      font-size: 1.8rem;
      font-weight: 700;
      color: #1a202c;
      margin: 0;
    }
    .form-header h2 {
      font-size: 1.1rem;
      font-weight: 500;
      color: #718096;
      margin-top: 0.5rem;
    }
    .progress-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      position: relative;
      height: 40px;
    }
    .progress-bar::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 20px;
      right: 20px;
      height: 4px;
      background: #e2e8f0;
      transform: translateY(-50%);
      z-index: 1;
      border-radius: 2px;
    }
    .progress-line-fill {
      position: absolute;
      top: 50%;
      left: 20px;
      height: 4px;
      background: linear-gradient(90deg, #3182ce, #63b3ed);
      transform: translateY(-50%);
      z-index: 1;
      transition: width 0.5s ease-in-out;
      border-radius: 2px;
      box-shadow: 0 0 6px rgba(49, 130, 206, 0.4);
    }
    .progress-step {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #e2e8f0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 1rem;
      color: #4a5568;
      position: relative;
      z-index: 2;
      transition: all 0.3s ease;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    .progress-step.active {
      background: linear-gradient(45deg, #3182ce, #63b3ed);
      color: white;
      transform: scale(1.1);
      box-shadow: 0 4px 12px rgba(49, 130, 206, 0.4);
    }
    .progress-step.completed {
      background: linear-gradient(45deg, #38a169, #68d391);
      color: white;
      box-shadow: 0 3px 10px rgba(56, 161, 105, 0.3);
    }
    .progress-step:not(.active):not(.completed):hover {
      background: #cbd5e0;
      transform: scale(1.05);
    }
    .step {
      display: none;
    }
    .step.active {
      display: block;
    }
    .form-group {
      margin-bottom: 1.5rem;
      padding: 1.2rem;
      border-radius: 1rem;
      background: #f7fafc;
      transition: background 0.3s ease, transform 0.2s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    .form-group:hover {
      background: #edf2f7;
      transform: translateY(-2px);
    }
    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      font-size: 1rem;
      color: #2d3748;
    }
    input, select, button {
      width: 100%;
      padding: 0.8rem;
      border: 1px solid #e2e8f0;
      border-radius: 0.6rem;
      box-sizing: border-box;
      font-size: 1rem;
      background: #ffffff;
      transition: border-color 0.3s ease, box-shadow 0.3s ease, background 0.3s ease;
      height: 2.8rem;
    }
    input:focus, select:focus, button:focus {
      outline: none;
      border-color: #3182ce;
      box-shadow: 0 0 6px rgba(49, 130, 206, 0.4);
      background: #f8fbff;
    }
    input:disabled, select:disabled {
      background: #edf2f7;
      color: #a0aec0;
      cursor: not-allowed;
    }
    .date-group {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .date-group select {
      width: 7rem;
      max-width: 100%;
    }
    .date-group select#birthYear {
      width: 9rem;
      max-width: 100%;
    }
    .date-group span {
      font-size: 1rem;
      color: #2d3748;
    }
    .category-group {
      display: flex;
      gap: 1rem;
      padding: 0.5rem 0;
    }
    .category-group label {
      display: flex;
      align-items: center;
      font-weight: 500;
      font-size: 1rem;
      color: #2d3748;
    }
    .category-group input[type="radio"], .category-group input[type="checkbox"] {
      width: auto;
      margin-right: 0.8rem;
      transform: scale(1);
    }
    .category-group label.disabled {
      color: #a0aec0;
      pointer-events: none;
    }
    .category-group input[type="radio"]:disabled, .category-group input[type="checkbox"]:disabled {
      opacity: 0.6;
    }
    .membership-group {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .membership-group input[type="text"] {
      flex-grow: 1;
      min-width: 200px;
    }
    .membership-group label {
      display: flex;
      align-items: center;
      font-weight: 500;
      font-size: 0.9rem;
      color: #2d3748;
      white-space: nowrap;
    }
    .membership-group input[type="checkbox"] {
      transform: scale(1);
    }
    .copy-group {
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .copy-group input[type="text"] {
      flex-grow: 1;
      min-width: 200px;
    }
    .copy-group label {
      display: flex;
      align-items: center;
      font-weight: 500;
      font-size: 0.9rem;
      color: #2d3748;
      white-space: nowrap;
    }
    .error {
      color: #e53e3e;
      font-size: 0.85rem;
      margin-top: 0.4rem;
      display: none;
    }
    .navigation {
      display: flex;
      justify-content: space-between;
      margin-top: 2rem;
      align-items: center;
    }
    .navigation button {
      padding: 0.8rem 1.5rem;
      border: none;
      border-radius: 0.6rem;
      cursor: pointer;
      font-weight: 600;
      min-height: 44px;
      touch-action: manipulation;
    }
    .nav-prev {
      background: #edf2f7;
      color: #718096;
    }
    .nav-prev:hover {
      background: #e2e8f0;
    }
    .nav-next, #submitBtn {
      background: linear-gradient(90deg, #3182ce, #2b6cb0);
      color: white;
    }
    .nav-next:hover, #submitBtn:hover {
      background: linear-gradient(90deg, #2b6cb0, #2c5282);
    }
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.75);
      justify-content: center;
      align-items: flex-start;
      z-index: 1000;
      padding-top: 1rem;
      padding-bottom: 1.5rem;
      overflow-y: auto;
    }
    .modal-content {
      background-color: #ffffff;
      padding: 1.5rem;
      border-radius: 1.2rem;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 10px 28px rgba(0, 0, 0, 0.2);
      display: flex;
      flex-direction: column;
      max-height: 85vh;
      overflow-y: auto;
      margin-bottom: 1.5rem;
    }
    .modal-scroll {
      flex-grow: 1;
      margin-bottom: 1.5rem;
      padding-right: 0.8rem;
    }
    .modal-content p {
      font-size: 1rem;
      margin: 0.8rem 0;
      color: #2d3748;
    }
    .modal-buttons {
      display: flex;
      gap: 1rem;
      padding-bottom: 1.5rem;
      position: sticky;
      bottom: 0;
      background: #ffffff;
      justify-content: center;
    }
    button.confirm, button.return-button {
      background: linear-gradient(90deg, #3182ce, #2b6cb0);
      color: white;
      border: none;
      cursor: pointer;
      padding: 0.8rem;
      border-radius: 0.6rem;
      transition: background 0.3s ease, transform 0.2s ease;
      min-height: 44px;
      min-width: 100px;
      font-size: 1rem;
      touch-action: manipulation;
    }
    button.confirm:hover, button.return-button:hover {
      background: linear-gradient(90deg, #2b6cb0, #2c5282);
      transform: translateY(-2px);
    }
    button.cancel {
      background: #edf2f7;
      color: #718096;
      padding: 0.8rem;
      border: none;
      border-radius: 0.6rem;
      cursor: pointer;
      transition: background 0.3s ease, transform 0.2s ease;
      min-height: 44px;
      min-width: 100px;
      font-size: 1rem;
      touch-action: manipulation;
    }
    button.cancel:hover {
      background: #e2e8f0;
      transform: translateY(-2px);
    }
    #submitBtn {
      margin-top: 0;
    }
    #thankYouPage {
      display: none;
      background: #ffffff;
      padding: 1.5rem;
      border-radius: 1.2rem;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      text-align: center;
      transition: transform 0.3s ease;
    }
    #thankYouPage:hover {
      transform: translateY(-4px);
    }
    #thankYouPage h2 {
      font-size: 1.6rem;
      margin-bottom: 1rem;
      color: #1a202c;
    }
    #thankYouPage p {
      font-size: 1rem;
      margin: 1rem 0;
      color: #38a169;
    }
    @media (max-width: 600px) {
      body {
        padding: 0.5rem;
        margin: 0.5rem;
      }
      .form-container, #thankYouPage {
        padding: 1.5rem;
        margin: 0.5rem;
        border-radius: 0.8rem;
      }
      .form-header h1 {
        font-size: 1.4rem;
      }
      .form-header h2 {
        font-size: 0.95rem;
      }
      .form-group {
        padding: 0.8rem;
        margin-bottom: 1rem;
      }
      input, select, button {
        padding: 0.7rem;
        font-size: 0.9rem;
        height: 2.5rem;
        border-radius: 0.5rem;
      }
      .date-group {
        gap: 0.4rem;
      }
      .date-group select {
        width: 5.5rem;
      }
      .date-group select#birthYear {
        width: 7rem;
      }
      .category-group, .membership-group, .copy-group {
        gap: 0.6rem;
        flex-wrap: wrap;
      }
      .membership-group input[type="text"], .copy-group input[type="text"] {
        min-width: 150px;
      }
      .membership-group label, .copy-group label {
        font-size: 0.85rem;
      }
      .modal {
        padding-top: 1rem;
        padding-bottom: 1.5rem;
      }
      .modal-content {
        width: 95%;
        padding: 1.2rem;
        max-height: 85vh;
        border-radius: 0.8rem;
      }
      .modal-content p {
        font-size: 0.9rem;
      }
      .modal-buttons {
        padding-bottom: 1.5rem;
        gap: 1rem;
      }
      button.confirm, button.cancel, button.return-button, #submitBtn {
        padding: 0.8rem;
        font-size: 0.95rem;
        min-height: 44px;
        min-width: 100px;
        touch-action: manipulation;
      }
      .navigation {
        flex-direction: column;
        gap: 1rem;
      }
      .progress-bar {
        height: 32px;
      }
      .progress-step {
        width: 32px;
        height: 32px;
        font-size: 0.9rem;
      }
      .progress-bar::before, .progress-line-fill {
        height: 3px;
        left: 16px;
        right: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="form-container" id="mainForm">
    <div class="form-header">
      <h1>香港學界跆拳道比賽2025-2026(中學及大專組)</h1>
      <h1>Secondary School and Tertiary Institution Taekwondo Competition 2025-2026</h1>
      <h2>報名表</h2>
    </div>
    <div class="progress-bar">
      <div class="progress-line-fill" id="progressLineFill"></div>
      <div class="progress-step active" data-step="1">1</div>
      <div class="progress-step" data-step="2">2</div>
      <div class="progress-step" data-step="3">3</div>
      <div class="progress-step" data-step="4">4</div>
    </div>
    <form id="registrationForm">
      <!-- 步驟一：學校資料 -->
      <div class="step active" data-step="1">
        <h3>步驟一：學校資料</h3>
        <div class="form-group">
          <label>就讀學校/院校名稱 *</label>
          <input type="text" id="schoolName" name="entry.1714227241" placeholder="以學生證上的中文名稱為準" required>
          <span id="schoolNameError" class="error">請輸入學校/院校名稱</span>
        </div>
        <div class="form-group">
          <label>學校程度 *</label>
          <div class="category-group">
            <label><input type="radio" name="entry.1924363147" value="中學 Secondary School" required> 中學 Secondary School</label>
            <label><input type="radio" name="entry.1924363147" value="大專院校 Tertiary Institution"> 大專院校 Tertiary Institution</label>
          </div>
          <span id="schoolLevelError" class="error">請選擇學校程度</span>
        </div>
        <div class="form-group">
          <label>學生證編號 *</label>
          <input type="text" id="studentId" name="entry.1820097193" required>
          <span id="studentIdError" class="error">請輸入學生證編號</span>
        </div>
        <div class="navigation">
          <button type="button" class="nav-prev" onclick="prevStep()" disabled>上一步</button>
          <button type="button" class="nav-next" onclick="nextStep()">下一步</button>
        </div>
      </div>

      <!-- 步驟二：個人資料 -->
      <div class="step" data-step="2">
        <h3>步驟二：個人資料</h3>
        <div class="form-group">
          <label>中文姓名 *</label>
          <input type="text" id="chineseName" name="entry.1739837016" placeholder="如沒有請填寫英文姓名 (請以大寫字母填寫)" required oninput="if(!/[\u4e00-\u9fa5]/.test(this.value)) this.value = this.value.toUpperCase()">
          <span id="chineseNameError" class="error">請輸入中文姓名或英文姓名</span>
        </div>
        <div class="form-group">
          <label>英文姓名 *</label>
          <input type="text" id="englishName" name="entry.69039678" placeholder="請以大寫字母填寫" required oninput="this.value = this.value.toUpperCase()">
          <span id="englishNameError" class="error">請輸入英文姓名</span>
        </div>
        <div class="form-group">
          <label>出生日期 YYYY-MM-DD *</label>
          <div class="date-group">
            <select id="birthYear" name="entry.71284989_year" required>
              <option value="">年</option>
            </select>
            <span>/</span>
            <select id="birthMonth" name="entry.71284989_month" required>
              <option value="">月</option>
            </select>
            <span>/</span>
            <select id="birthDay" name="entry.71284989_day" required>
              <option value="">日</option>
            </select>
          </div>
          <input type="hidden" id="birthDate" name="entry.71284989">
          <span id="birthDateError" class="error">請選擇有效的出生日期</span>
        </div>
        <div class="form-group">
          <label>性別 *</label>
          <div class="category-group">
            <label><input type="radio" name="entry.269558714" value="男 Male" required> 男 Male</label>
            <label><input type="radio" name="entry.269558714" value="女 Female"> 女 Female</label>
          </div>
          <span id="genderError" class="error">請選擇性別</span>
        </div>
        <div class="navigation">
          <button type="button" class="nav-prev" onclick="prevStep()">上一步</button>
          <button type="button" class="nav-next" onclick="nextStep()">下一步</button>
        </div>
      </div>

      <!-- 步驟三：聯絡資料 -->
      <div class="step" data-step="3">
        <h3>步驟三：聯絡資料</h3>
        <div class="form-group">
          <label>聯絡電話 *</label>
          <input type="tel" id="phone" name="entry.1045318375" pattern="\d{8}" required>
          <span id="phoneError" class="error">請輸入有效的8位電話號碼</span>
        </div>
        <div class="form-group">
          <label>緊急聯絡人 *</label>
          <input type="text" id="emergencyContact" name="entry.1921234097" required>
          <span id="emergencyContactError" class="error">請輸入緊急聯絡人</span>
        </div>
        <div class="form-group">
          <label>緊急聯絡人電話 *</label>
          <div class="copy-group">
            <input type="tel" id="emergencyPhone" name="entry.1294289670" pattern="\d{8}" required>
            <label><input type="checkbox" id="copyPhone"> 與聯絡電話相同</label>
          </div>
          <span id="emergencyPhoneError" class="error">請輸入有效的8位電話號碼</span>
        </div>
        <div class="navigation">
          <button type="button" class="nav-prev" onclick="prevStep()">上一步</button>
          <button type="button" class="nav-next" onclick="nextStep()">下一步</button>
        </div>
      </div>

      <!-- 步驟四：參賽資料 -->
      <div class="step" data-step="4">
        <h3>步驟四：參賽資料</h3>
        <div class="form-group">
          <label>屬會名稱 *</label>
          <input list="affiliations" id="affiliation" name="entry.629960054" required placeholder="點擊輸入或選擇屬會名稱">
          <datalist id="affiliations">
            <option value="香港仔跆拳道會 Aberdeen TKD Club">
            <option value="技擊跆拳道會 Advanced TKD Association">
            <option value="躍駿跆拳道會 Attack TKD Association">
            <option value="青雲跆拳道會 Ching Wan TKD Association">
            <option value="精英跆拳道會 Ching Ying TKD Union">
            <option value="金柏跆拳道協會 Combat TKD Association">
            <option value="香港跆拳道東龍會 Eastern Dragon TKD Federation HK">
            <option value="勵志跆拳道總會 Encouragement TKD Association">
            <option value="香港智道跆拳總會 HK Chido TKD Association">
            <option value="香港啟聯跆拳道協會 HK Kai Luen TKD Association">
            <option value="香港尼泊爾跆拳道會 HK Nepalese TKD Club">
            <option value="香港實用跆拳道協會 HK Practical TKD Association">
            <option value="香港跆拳道振武館 HK TKD Chun Mo Kwan">
            <option value="香港跆拳道勵進會 HK TKD Action Association">
            <option value="香港跆拳道勵誠會 HK TKD Active Association">
            <option value="香港跆拳道勵輝會 HK TKD Actual Association">
            <option value="香港中道跆拳道會 HK Chong Do TKD Association">
            <option value="香港跆拳道青濤館 HK TKD Chung Do Kwan">
            <option value="香港跆拳道正道館 HK TKD Jung Do Kwan">
            <option value="香港跆拳道正心館 HK TKD Jung Sim Kwan">
            <option value="香港聯盟跆拳道協會 HK United TKD Association">
            <option value="跆拳道明道會 TKD Bright Way Association">
            <option value="漢道跆拳道館 Hon Do TKD Kwan">
            <option value="國際跆拳道香港總會 International TKD HK Association">
            <option value="韓國跆拳道青道館 Korea TKD Cheung Do Kwan">
            <option value="樂華跆拳道會 Lok Wah TKD Club">
            <option value="銘英跆拳道會 Main Pioneer TKD Association">
            <option value="跆拳道武德會 Moo Duk TKD Hae">
            <option value="伍華跆拳道會 Ng Wah TKD Club">
            <option value="毅武聯盟跆拳道 Ngai Mo Alliance TKD">
            <option value="香港警察跆拳道會 HK Police TKD Club">
            <option value="香港跆拳道國藝會 Potential TKD HK Association">
            <option value="尚武聯跆拳道會 Sheung Mo Luen TKD Association">
            <option value="捷擊跆拳道館 TKD Jet Kick Kwan">
            <option value="跆拳道吾道會體育館 TKD Oh Do Hae Gymnasium">
            <option value="香港胡氏跆拳道會 Wu’s TKD HK Association">
            <option value="正武會跆拳道協會 Zheng Wu TKD Association">
            <option value="香港發景跆拳道會 Hong Kong Greatview TKD Club">
            <option value="香港跆拳道柏毅會 Hong Kong TKD Pak Ngai Association">
            <option value="香港跆拳道嚴濤會 Hong Kong TKD Uhm Do Club">
            <option value="威格跆拳道會 Warrior TKD Club">
            <option value="金道跆拳道聯盟 The Kimdo TKD Federation">
            <option value="金道一跆拳道館 Kim Do Yi TKD Kwan">
            <option value="樂武跆拳道會 Cheerful TKD Association Limited">
            <option value="世紀跆拳道會 H.K. Taekwondo Cosmopolitan Club">
            <option value="燊．跆拳道館 Sun Taekwondo Club">
            <option value="香港進和跆拳道會 Hong Kong Chun Wo Taekwondo Association">
            <option value="香港賢薈跆拳道會 Hong Kong Ultimate Taekwondo Club">
          </datalist>
          <span id="affiliationError" class="error">請選擇或輸入屬會名稱</span>
        </div>
        <div class="form-group">
          <label>會員證/段證編號 *</label>
          <div class="membership-group">
            <input type="text" id="membershipNumber" name="entry.274850195" required>
            <label><input type="checkbox" id="noMembership" value="未有會員證/段證"> 未有會員證/段證</label>
          </div>
          <span id="membershipNumberError" class="error">請輸入會員證/段證編號或勾選“未有會員證/段證”</span>
        </div>
        <div class="form-group">
          <label>現有級別 *</label>
          <select id="beltLevel" name="entry.1597491054" required>
            <option value="">請選擇級別</option>
            <option value="綠帶 Green Belt">綠帶 Green Belt</option>
            <option value="綠藍帶 Green-Blue Belt">綠藍帶 Green-Blue Belt</option>
            <option value="藍帶 Blue Belt">藍帶 Blue Belt</option>
            <option value="藍紅帶 Blue-Red Belt">藍紅帶 Blue-Red Belt</option>
            <option value="紅帶 Red Belt">紅帶 Red Belt</option>
            <option value="紅黑帶 Red-Black Belt">紅黑帶 Red-Black Belt</option>
            <option value="黑帶一品/段 1 Poom/Dan">黑帶一品/段 1 Poom/Dan</option>
            <option value="黑帶二品/段 2 Poom/Dan">黑帶二品/段 2 Poom/Dan</option>
            <option value="黑帶三品/段或以上 3 Poom/Dan or above">黑帶三品/段或以上 3 Poom/Dan or above</option>
          </select>
          <span id="beltLevelError" class="error">請選擇現有級別</span>
        </div>
        <div class="form-group">
          <label>參賽者高度 (cm) *</label>
          <input type="number" id="height" name="entry.703788026" required>
          <span id="heightError" class="error">請輸入有效的身高</span>
        </div>
        <div class="form-group">
          <label>參賽者重量 (kg) *</label>
          <input type="number" id="weight" name="entry.1666612578" required>
          <span id="weightError" class="error">請輸入有效的體重</span>
        </div>
        <div class="form-group">
          <label>搏擊級別劃分 *</label>
          <select id="kyorugiDivision" name="entry.1084612574" required>
            <option value="">請選擇搏擊級別</option>
          </select>
          <span id="kyorugiDivisionError" class="error">請選擇搏擊級別</span>
        </div>
        <div class="form-group">
          <label>搏擊量級 *</label>
          <select id="weightClass" name="entry.1721761818" required>
            <option value="">請選擇搏擊量級</option>
          </select>
          <span id="weightClassError" class="error">請選擇搏擊量級</span>
        </div>
        <div class="navigation">
          <button type="button" class="nav-prev" onclick="prevStep()">上一步</button>
          <button type="button" id="submitBtn" onclick="submitForm()">提交表單</button>
        </div>
      </div>
    </form>
  </div>

  <div id="confirmModal" class="modal">
    <div class="modal-content">
      <div class="modal-scroll">
        <h2>請確認您的報名資料</h2>
        <p><strong>就讀學校/院校名稱：</strong> <span id="confirmSchoolName"></span></p>
        <p><strong>學校程度：</strong> <span id="confirmSchoolLevel"></span></p>
        <p><strong>學生證編號：</strong> <span id="confirmStudentId"></span></p>
        <p><strong>屬會名稱：</strong> <span id="confirmAffiliation"></span></p>
        <p><strong>會員證/段證編號：</strong> <span id="confirmMembershipNumber"></span></p>
        <p><strong>中文姓名：</strong> <span id="confirmChineseName"></span></p>
        <p><strong>英文姓名：</strong> <span id="confirmEnglishName"></span></p>
        <p><strong>出生日期：</strong> <span id="confirmBirthDate"></span></p>
        <p><strong>性別：</strong> <span id="confirmGender"></span></p>
        <p><strong>聯絡電話：</strong> <span id="confirmPhone"></span></p>
        <p><strong>現有級別：</strong> <span id="confirmBeltLevel"></span></p>
        <p><strong>參賽者高度：</strong> <span id="confirmHeight"></span></p>
        <p><strong>參賽者重量：</strong> <span id="confirmWeight"></span></p>
        <p><strong>搏擊級別劃分：</strong> <span id="confirmKyorugiDivision"></span></p>
        <p><strong>搏擊量級：</strong> <span id="confirmWeightClass"></span></p>
        <p><strong>緊急聯絡人：</strong> <span id="confirmEmergencyContact"></span></p>
        <p><strong>緊急聯絡人電話：</strong> <span id="confirmEmergencyPhone"></span></p>
      </div>
      <div class="modal-buttons">
        <button class="cancel" onclick="cancelSubmission()">取消</button>
        <button class="confirm" onclick="confirmSubmission()">確認提交</button>
      </div>
    </div>
  </div>

  <div id="thankYouPage">
    <h2>感謝您的報名！</h2>
    <p>確認後教練將盡快與您聯繫核對資料。</p>
    <p>請將家長同意書、會員證及學生證副本交給教練。</p>
    <p id="noMembershipReminder" style="display: none;">如未有會員證/段證，請盡快向所屬屬會申請，以便完成報名，申請需時。</p>
    <button class="return-button" onclick="restartForm()">重新報名</button>
  </div>

  <script>
    let currentStep = 1;

    // 搏擊級別劃分選項
    const kyorugiDivisions = {
      '中學 Secondary School': {
        'color': {
          '男 Male': {
            '2011-2013': '中學男子色帶A組 Color Belt Group A 12歲至14歲 Age: 12 to 14 (2011年至2013年出生者)',
            '2010-': '中學男子色帶B組 Color Belt Group B 15歲或以上 Age: 15 or above (2010年或之前出生者)'
          },
          '女 Female': {
            '2011-2013': '中學女子色帶C組 Color Belt Group C 12歲至14歲 Age: 12 to 14 (2011年至2013年出生者)',
            '2010-': '中學女子色帶D組 Color Belt Group D 15歲或以上 Age: 15 or above (2010年或之前出生者)'
          }
        },
        'black': {
          '男 Male': {
            '2011-2013': '中學男子黑帶BA組 Black Belt Group BA 12歲至14歲 Age: 12 to 14 (2011年至2013年出生者)',
            '2010-': '中學男子黑帶BB組 Black Belt Group BB 15歲或以上 Age: 15 or above (2010年或之前出生者)'
          },
          '女 Female': {
            '2011-2013': '中學女子黑帶BC組 Black Belt Group BC 12歲至14歲 Age: 12 to 14 (2011年至2013年出生者)',
            '2010-': '中學女子黑帶BD組 Black Belt Group BD 15歲或以上 Age: 15 or above (2010年或之前出生者)'
          }
        }
      },
      '大專院校 Tertiary Institution': {
        'color': {
          '男 Male': {
            '1997-2009': '大專男子色帶E組 Color Belt Group E 16歲至28歲 Age: 16 to 28 (1997年至2009年出生者)'
          },
          '女 Female': {
            '1997-2009': '大專女子色帶F組 Color Belt Group F 16歲至28歲 Age: 16 to 28 (1997年至2009年出生者)'
          }
        }
      }
    };

    // 色帶級別
    const colorBeltLevels = [
      '綠帶 Green Belt', '綠藍帶 Green-Blue Belt', '藍帶 Blue Belt', '藍紅帶 Blue-Red Belt',
      '紅帶 Red Belt', '紅黑帶 Red-Black Belt'
    ];

    // 黑帶級別
    const blackBeltLevels = [
      '黑帶一品/段 1 Poom/Dan', '黑帶二品/段 2 Poom/Dan', '黑帶三品/段或以上 3 Poom/Dan or above'
    ];

    // 搏擊量級選項
    const weightClasses = {
      '中學男子色帶A組 Color Belt Group A 12歲至14歲 Age: 12 to 14 (2011年至2013年出生者)': [
        'FIN 鰭量級 (33公斤以下)', 'FLY 蠅量級 (33公斤以上而不超過37公斤)', 'BANTAM 雛量級 (37公斤以上而不超過41公斤)', 
        'FEATHER 羽量級 (41公斤以上而不超過45公斤)', 'LIGHT 輕量級 (45公斤以上而不超過49公斤)', 'WELTER 沉量級 (49公斤以上而不超過53公斤)', 
        'LIGHT MIDDLE 輕中量級 (53公斤以上而不超過57公斤)', 'MIDDLE 中量級 (57公斤以上而不超過61公斤)', 'LIGHT HEAVY 輕重量級 (61公斤以上而不超過65公斤)', 
        'HEAVY 重量級 (65公斤以上)'
      ],
      '中學男子色帶B組 Color Belt Group B 15歲或以上 Age: 15 or above (2010年或之前出生者)': [
        'FIN 鰭量級 (45公斤以下)', 'FLY 蠅量級 (45公斤以上而不超過48公斤)', 'BANTAM 雛量級 (48公斤以上而不超過51公斤)', 
        'FEATHER 羽量級 (51公斤以上而不超過55公斤)', 'LIGHT 輕量級 (55公斤以上而不超過59公斤)', 'WELTER 沉量級 (59公斤以上而不超過63公斤)', 
        'LIGHT MIDDLE 輕中量級 (63公斤以上而不超過68公斤)', 'MIDDLE 中量級 (68公斤以上而不超過73公斤)', 'LIGHT HEAVY 輕重量級 (73公斤以上而不超過78公斤)', 
        'HEAVY 重量級 (78公斤以上)'
      ],
      '中學女子色帶C組 Color Belt Group C 12歲至14歲 Age: 12 to 14 (2011年至2013年出生者)': [
        'FIN 鰭量級 (29公斤以下)', 'FLY 蠅量級 (29公斤以上而不超過33公斤)', 'BANTAM 雛量級 (33公斤以上而不超過37公斤)', 
        'FEATHER 羽量級 (37公斤以上而不超過41公斤)', 'LIGHT 輕量級 (41公斤以上而不超過44公斤)', 'WELTER 沉量級 (44公斤以上而不超過47公斤)', 
        'LIGHT MIDDLE 輕中量級 (47公斤以上而不超過51公斤)', 'MIDDLE 中量級 (51公斤以上而不超過55公斤)', 'LIGHT HEAVY 輕重量級 (55公斤以上而不超過59公斤)', 
        'HEAVY 重量級 (59公斤以上)'
      ],
      '中學女子色帶D組 Color Belt Group D 15歲或以上 Age: 15 or above (2010年或之前出生者)': [
        'FIN 鰭量級 (42公斤以下)', 'FLY 蠅量級 (42公斤以上而不超過44公斤)', 'BANTAM 雛量級 (44公斤以上而不超過46公斤)', 
        'FEATHER 羽量級 (46公斤以上而不超過49公斤)', 'LIGHT 輕量級 (49公斤以上而不超過52公斤)', 'WELTER 沉量級 (52公斤以上而不超過55公斤)', 
        'LIGHT MIDDLE 輕中量級 (55公斤以上而不超過59公斤)', 'MIDDLE 中量級 (59公斤以上而不超過63公斤)', 'LIGHT HEAVY 輕重量級 (63公斤以上而不超過68公斤)', 
        'HEAVY 重量級 (68公斤以上)'
      ],
      '大專男子色帶E組 Color Belt Group E 16歲至28歲 Age: 16 to 28 (1997年至2009年出生者)': [
        'FIN 鰭量級 (54公斤以下)', 'FLY 蠅量級 (54公斤以上而不超過58公斤)', 'BANTAM 雛量級 (58公斤以上而不超過63公斤)', 
        'FEATHER 羽量級 (63公斤以上而不超過68公斤)', 'LIGHT 輕量級 (68公斤以上而不超過74公斤)', 'WELTER 沉量級 (74公斤以上而不超過80公斤)', 
        'MIDDLE 中量級 (80公斤以上而不超過87公斤)', 'HEAVY 重量級 (87公斤以上)'
      ],
      '大專女子色帶F組 Color Belt Group F 16歲至28歲 Age: 16 to 28 (1997年至2009年出生者)': [
        'FIN 鰭量級 (46公斤以下)', 'FLY 蠅量級 (46公斤以上而不超過49公斤)', 'BANTAM 雛量級 (49公斤以上而不超過53公斤)', 
        'FEATHER 羽量級 (53公斤以上而不超過57公斤)', 'LIGHT 輕量級 (57公斤以上而不超過62公斤)', 'WELTER 沉量級 (62公斤以上而不超過67公斤)', 
        'MIDDLE 中量級 (67公斤以上而不超過73公斤)', 'HEAVY 重量級 (73公斤以上)'
      ],
      '中學男子黑帶BA組 Black Belt Group BA 12歲至14歲 Age: 12 to 14 (2011年至2013年出生者)': [
        'FIN 鰭量級 (33公斤以下)', 'FLY 蠅量級 (33公斤以上而不超過37公斤)', 'BANTAM 雛量級 (37公斤以上而不超過41公斤)', 
        'FEATHER 羽量級 (41公斤以上而不超過45公斤)', 'LIGHT 輕量級 (45公斤以上而不超過49公斤)', 'WELTER 沉量級 (49公斤以上而不超過53公斤)', 
        'LIGHT MIDDLE 輕中量級 (53公斤以上而不超過57公斤)', 'MIDDLE 中量級 (57公斤以上而不超過61公斤)', 'LIGHT HEAVY 輕重量級 (61公斤以上而不超過65公斤)', 
        'HEAVY 重量級 (65公斤以上)'
      ],
      '中學男子黑帶BB組 Black Belt Group BB 15歲或以上 Age: 15 or above (2010年或之前出生者)': [
        'FIN 鰭量級 (45公斤以下)', 'FLY 蠅量級 (45公斤以上而不超過48公斤)', 'BANTAM 雛量級 (48公斤以上而不超過51公斤)', 
        'FEATHER 羽量級 (51公斤以上而不超過55公斤)', 'LIGHT 輕量級 (55公斤以上而不超過59公斤)', 'WELTER 沉量級 (59公斤以上而不超過63公斤)', 
        'LIGHT MIDDLE 輕中量級 (63公斤以上而不超過68公斤)', 'MIDDLE 中量級 (68公斤以上而不超過73公斤)', 'LIGHT HEAVY 輕重量級 (73公斤以上而不超過78公斤)', 
        'HEAVY 重量級 (78公斤以上)'
      ],
      '中學女子黑帶BC組 Black Belt Group BC 12歲至14歲 Age: 12 to 14 (2011年至2013年出生者)': [
        'FIN 鰭量級 (29公斤以下)', 'FLY 蠅量級 (29公斤以上而不超過33公斤)', 'BANTAM 雛量級 (33公斤以上而不超過37公斤)', 
        'FEATHER 羽量級 (37公斤以上而不超過41公斤)', 'LIGHT 輕量級 (41公斤以上而不超過44公斤)', 'WELTER 沉量級 (44公斤以上而不超過47公斤)', 
        'LIGHT MIDDLE 輕中量級 (47公斤以上而不超過51公斤)', 'MIDDLE 中量級 (51公斤以上而不超過55公斤)', 'LIGHT HEAVY 輕重量級 (55公斤以上而不超過59公斤)', 
        'HEAVY 重量級 (59公斤以上)'
      ],
      '中學女子黑帶BD組 Black Belt Group BD 15歲或以上 Age: 15 or above (2010年或之前出生者)': [
        'FIN 鰭量級 (42公斤以下)', 'FLY 蠅量級 (42公斤以上而不超過44公斤)', 'BANTAM 雛量級 (44公斤以上而不超過46公斤)', 
        'FEATHER 羽量級 (46公斤以上而不超過49公斤)', 'LIGHT 輕量級 (49公斤以上而不超過52公斤)', 'WELTER 沉量級 (52公斤以上而不超過55公斤)', 
        'LIGHT MIDDLE 輕中量級 (55公斤以上而不超過59公斤)', 'MIDDLE 中量級 (59公斤以上而不超過63公斤)', 'LIGHT HEAVY 輕重量級 (63公斤以上而不超過68公斤)', 
        'HEAVY 重量級 (68公斤以上)'
      ]
    };

    // 步驟導航
    function updateProgress() {
      const steps = document.querySelectorAll('.progress-step');
      const stepContents = document.querySelectorAll('.step');
      const progressLineFill = document.getElementById('progressLineFill');
      const totalSteps = steps.length;

      // 更新步驟狀態
      steps.forEach((step, index) => {
        const stepNumber = index + 1;
        step.textContent = stepNumber; // 確保編號從1開始
        if (stepNumber < currentStep) {
          step.classList.add('completed');
          step.classList.remove('active');
        } else if (stepNumber === currentStep) {
          step.classList.add('active');
          step.classList.remove('completed');
        } else {
          step.classList.remove('active', 'completed');
        }
      });

      // 顯示/隱藏步驟內容
      stepContents.forEach(content => {
        content.classList.remove('active');
        if (parseInt(content.dataset.step) === currentStep) {
          content.classList.add('active');
        }
      });

      // 更新進度條
      const progressWidth = ((currentStep - 1) / (totalSteps - 1)) * (100 - (40 / document.querySelector('.progress-bar').offsetWidth) * 100);
      progressLineFill.style.width = `${progressWidth}%`;

      // 更新導航按鈕
      const prevButton = document.querySelector('.nav-prev');
      const nextButton = document.querySelector('.nav-next');
      const submitButton = document.getElementById('submitBtn');
      prevButton.disabled = currentStep === 1;
      nextButton.style.display = currentStep === totalSteps ? 'none' : 'block';
      submitButton.style.display = currentStep === totalSteps ? 'block' : 'none';
    }

    function nextStep() {
      if (validateStep(currentStep)) {
        currentStep++;
        if (currentStep > 4) currentStep = 4;
        updateProgress();
      }
    }

    function prevStep() {
      currentStep--;
      if (currentStep < 1) currentStep = 1;
      updateProgress();
    }

    function validateStep(step) {
      let isValid = true;
      const isTestMode = document.getElementById('schoolName').value.toLowerCase().includes('test');
      if (isTestMode) return true;

      // 重置所有錯誤提示
      document.querySelectorAll('.error').forEach(e => e.style.display = 'none');

      switch (step) {
        case 1:
          if (!document.getElementById('schoolName').value.trim()) {
            document.getElementById('schoolNameError').style.display = 'block';
            isValid = false;
          }
          if (!Array.from(document.getElementsByName('entry.1924363147')).some(r => r.checked)) {
            document.getElementById('schoolLevelError').style.display = 'block';
            isValid = false;
          }
          if (!document.getElementById('studentId').value.trim()) {
            document.getElementById('studentIdError').style.display = 'block';
            isValid = false;
          }
          break;
        case 2:
          if (!document.getElementById('chineseName').value.trim()) {
            document.getElementById('chineseNameError').style.display = 'block';
            isValid = false;
          }
          if (!document.getElementById('englishName').value.trim()) {
            document.getElementById('englishNameError').style.display = 'block';
            isValid = false;
          }
          if (!document.getElementById('birthDate').value) {
            document.getElementById('birthDateError').style.display = 'block';
            isValid = false;
          }
          if (!Array.from(document.getElementsByName('entry.269558714')).some(r => r.checked)) {
            document.getElementById('genderError').style.display = 'block';
            isValid = false;
          }
          break;
        case 3:
          if (!document.getElementById('phone').value.match(/^\d{8}$/)) {
            document.getElementById('phoneError').style.display = 'block';
            isValid = false;
          }
          if (!document.getElementById('emergencyContact').value.trim()) {
            document.getElementById('emergencyContactError').style.display = 'block';
            isValid = false;
          }
          if (!document.getElementById('emergencyPhone').value.match(/^\d{8}$/)) {
            document.getElementById('emergencyPhoneError').style.display = 'block';
            isValid = false;
          }
          break;
        case 4:
          if (!document.getElementById('affiliation').value.trim()) {
            document.getElementById('affiliationError').style.display = 'block';
            isValid = false;
          }
          if (!document.getElementById('membershipNumber').value.trim() && !document.getElementById('noMembership').checked) {
            document.getElementById('membershipNumberError').style.display = 'block';
            isValid = false;
          }
          if (!document.getElementById('beltLevel').value) {
            document.getElementById('beltLevelError').style.display = 'block';
            isValid = false;
          }
          if (!document.getElementById('height').value || document.getElementById('height').value <= 0) {
            document.getElementById('heightError').style.display = 'block';
            isValid = false;
          }
          if (!document.getElementById('weight').value || document.getElementById('weight').value <= 0) {
            document.getElementById('weightError').style.display = 'block';
            isValid = false;
          }
          if (!document.getElementById('kyorugiDivision').value) {
            document.getElementById('kyorugiDivisionError').style.display = 'block';
            isValid = false;
          }
          if (!document.getElementById('weightClass').value) {
            document.getElementById('weightClassError').style.display = 'block';
            isValid = false;
          }
          break;
      }
      return isValid;
    }

    // 提交表單
    function submitForm() {
      if (validateStep(4)) {
        const confirmModal = document.getElementById('confirmModal');
        document.getElementById('confirmSchoolName').textContent = document.getElementById('schoolName').value || '未填寫';
        document.getElementById('confirmSchoolLevel').textContent = Array.from(document.getElementsByName('entry.1924363147')).find(r => r.checked)?.value || '未選擇';
        document.getElementById('confirmStudentId').textContent = document.getElementById('studentId').value || '未填寫';
        document.getElementById('confirmAffiliation').textContent = document.getElementById('affiliation').value || '未填寫';
        document.getElementById('confirmMembershipNumber').textContent = document.getElementById('noMembership').checked ? '未有會員證/段證' : (document.getElementById('membershipNumber').value || '未填寫');
        document.getElementById('confirmChineseName').textContent = document.getElementById('chineseName').value || '未填寫';
        document.getElementById('confirmEnglishName').textContent = document.getElementById('englishName').value || '未填寫';
        document.getElementById('confirmBirthDate').textContent = document.getElementById('birthDate').value || '未填寫';
        document.getElementById('confirmGender').textContent = Array.from(document.getElementsByName('entry.269558714')).find(r => r.checked)?.value || '未選擇';
        document.getElementById('confirmPhone').textContent = document.getElementById('phone').value || '未填寫';
        document.getElementById('confirmBeltLevel').textContent = document.getElementById('beltLevel').value || '未選擇';
        document.getElementById('confirmHeight').textContent = document.getElementById('height').value || '未填寫';
        document.getElementById('confirmWeight').textContent = document.getElementById('weight').value || '未填寫';
        document.getElementById('confirmKyorugiDivision').textContent = document.getElementById('kyorugiDivision').value || '未選擇';
        document.getElementById('confirmWeightClass').textContent = document.getElementById('weightClass').value || '未選擇';
        document.getElementById('confirmEmergencyContact').textContent = document.getElementById('emergencyContact').value || '未填寫';
        document.getElementById('confirmEmergencyPhone').textContent = document.getElementById('emergencyPhone').value || '未填寫';
        confirmModal.style.display = 'flex';
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
    }

    function cancelSubmission() {
      document.getElementById('confirmModal').style.display = 'none';
    }

    async function confirmSubmission() {
      const form = document.getElementById('registrationForm');
      const formData = new FormData(form);
      const noMembershipCheckbox = document.getElementById('noMembership');
      const membershipNumberInput = document.getElementById('membershipNumber');

      if (document.getElementById('birthYear').value && document.getElementById('birthMonth').value && document.getElementById('birthDay').value) {
        formData.set('entry.71284989', `${document.getElementById('birthYear').value}-${document.getElementById('birthMonth').value.toString().padStart(2, '0')}-${document.getElementById('birthDay').value.toString().padStart(2, '0')}`);
      }
      formData.delete('entry.71284989_year');
      formData.delete('entry.71284989_month');
      formData.delete('entry.71284989_day');

      if (noMembershipCheckbox.checked) {
        formData.set('entry.274850195', '未有會員證/段證');
      } else {
        formData.set('entry.274850195', membershipNumberInput.value);
      }
      formData.delete('noMembership');

      try {
        await fetch('https://docs.google.com/forms/d/e/1FAIpQLScwWnfC3U3ldbnfYO6TJLfo87oU5ZN4C5snUUVkFTJfdJfY6A/formResponse', {
          method: 'POST',
          mode: 'no-cors',
          body: formData
        });
        document.getElementById('confirmModal').style.display = 'none';
        document.getElementById('mainForm').style.display = 'none';
        document.getElementById('thankYouPage').style.display = 'block';
        document.getElementById('noMembershipReminder').style.display = noMembershipCheckbox.checked ? 'block' : 'none';
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } catch (error) {
        console.error('表單提交失敗:', error);
        alert('表單提交失敗，請檢查控制台日誌或聯繫管理員。');
      }
    }

    function restartForm() {
      currentStep = 1;
      document.getElementById('registrationForm').reset();
      document.getElementById('thankYouPage').style.display = 'none';
      document.getElementById('mainForm').style.display = 'block';
      updateProgress();
      updateBeltLevelOptions();
      updateKyorugiOptions();
      populateDateSelects('birthYear', 'birthMonth', 'birthDay', 'birthDate');
    }

    // 日期填充
    function populateDateSelects(yearSelectId, monthSelectId, daySelectId, hiddenInputId) {
      const yearSelect = document.getElementById(yearSelectId);
      const monthSelect = document.getElementById(monthSelectId);
      const daySelect = document.getElementById(daySelectId);
      const hiddenInput = document.getElementById(hiddenInputId);
      const schoolLevel = Array.from(document.getElementsByName('entry.1924363147')).find(r => r.checked)?.value;

      yearSelect.innerHTML = '<option value="">年</option>';
      const startYear = schoolLevel === '大專院校 Tertiary Institution' ? 2009 : 2013;
      for (let year = startYear; year >= 1997; year--) {
        let option = document.createElement('option');
        option.value = year;
        option.text = year;
        yearSelect.appendChild(option);
      }

      for (let month = 1; month <= 12; month++) {
        let option = document.createElement('option');
        option.value = month;
        option.text = month.toString().padStart(2, '0');
        monthSelect.appendChild(option);
      }

      function isLeapYear(year) {
        return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
      }

      function updateDays() {
        const year = parseInt(yearSelect.value) || startYear;
        const month = parseInt(monthSelect.value) || 1;
        const prevDay = daySelect.value;
        daySelect.innerHTML = '<option value="">日</option>';
        const daysInMonth = [31, isLeapYear(year) ? 29 : 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month - 1];
        for (let day = 1; day <= daysInMonth; day++) {
          let option = document.createElement('option');
          option.value = day;
          option.text = day.toString().padStart(2, '0');
          daySelect.appendChild(option);
        }
        if (prevDay && parseInt(prevDay) <= daysInMonth) {
          daySelect.value = prevDay;
        }
        updateHiddenInput();
      }

      function updateHiddenInput() {
        const year = yearSelect.value;
        const month = monthSelect.value;
        const day = daySelect.value;
        if (year && month && day) {
          hiddenInput.value = `${year}-${month.toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
        } else {
          hiddenInput.value = '';
        }
        updateKyorugiOptions();
      }

      yearSelect.addEventListener('change', updateDays);
      monthSelect.addEventListener('change', updateDays);
      daySelect.addEventListener('change', updateHiddenInput);

      updateDays();
    }

    // 更新級別選項
    function updateBeltLevelOptions() {
      const schoolLevel = Array.from(document.getElementsByName('entry.1924363147')).find(r => r.checked)?.value;
      const beltLevelSelect = document.getElementById('beltLevel');
      const previousValue = beltLevelSelect.value;
      beltLevelSelect.innerHTML = '<option value="">請選擇級別</option>';

      const availableBeltLevels = schoolLevel === '中學 Secondary School' 
        ? [...colorBeltLevels, ...blackBeltLevels]
        : colorBeltLevels;

      availableBeltLevels.forEach(level => {
        const option = document.createElement('option');
        option.value = level;
        option.text = level;
        beltLevelSelect.appendChild(option);
      });

      if (availableBeltLevels.includes(previousValue)) {
        beltLevelSelect.value = previousValue;
      }
      updateKyorugiOptions();
    }

    // 更新搏擊選項
    function updateKyorugiOptions() {
      const birthYear = parseInt(document.getElementById('birthYear').value);
      const schoolLevel = Array.from(document.getElementsByName('entry.1924363147')).find(r => r.checked)?.value;
      const gender = Array.from(document.getElementsByName('entry.269558714')).find(r => r.checked)?.value;
      const beltLevel = document.getElementById('beltLevel').value;
      const kyorugiDivisionSelect = document.getElementById('kyorugiDivision');
      const previousValue = kyorugiDivisionSelect.value;

      kyorugiDivisionSelect.innerHTML = '<option value="">請選擇搏擊級別</option>';

      if (!birthYear || !gender || !beltLevel || !schoolLevel) {
        const allOptions = new Set();
        Object.values(kyorugiDivisions).forEach(level => {
          Object.values(level).forEach(type => {
            Object.values(type).forEach(g => {
              Object.values(g).forEach(d => allOptions.add(d));
            });
          });
        });
        Array.from(allOptions).sort().forEach(division => {
          const option = document.createElement('option');
          option.value = division;
          option.text = division;
          kyorugiDivisionSelect.appendChild(option);
        });
        if (previousValue && allOptions.has(previousValue)) kyorugiDivisionSelect.value = previousValue;
      } else {
        const isBlackBelt = blackBeltLevels.includes(beltLevel);
        let beltType = isBlackBelt ? 'black' : 'color';

        if (schoolLevel === '大專院校 Tertiary Institution' && beltType === 'black') {
          return;
        }

        const divisions = kyorugiDivisions[schoolLevel]?.[beltType]?.[gender];
        if (divisions) {
          let ageKey;
          if (schoolLevel === '中學 Secondary School') {
            ageKey = (birthYear >= 2011 && birthYear <= 2013) ? '2011-2013' : (birthYear <= 2010 && birthYear >= 1997 ? '2010-' : null);
          } else if (schoolLevel === '大專院校 Tertiary Institution') {
            ageKey = (birthYear >= 1997 && birthYear <= 2009) ? '1997-2009' : null;
          }
          if (ageKey && divisions[ageKey]) {
            const option = document.createElement('option');
            option.value = divisions[ageKey];
            option.text = divisions[ageKey];
            kyorugiDivisionSelect.appendChild(option);
            kyorugiDivisionSelect.value = divisions[ageKey];
          }
        }
      }
      updateWeightClassOptions();
    }

    function updateWeightClassOptions() {
      const kyorugiDivision = document.getElementById('kyorugiDivision').value;
      const weightClassSelect = document.getElementById('weightClass');
      const previousValue = weightClassSelect.value; // 保存當前選擇

      weightClassSelect.innerHTML = '<option value="">請選擇搏擊量級</option>';

      if (kyorugiDivision && weightClasses[kyorugiDivision]) {
        weightClasses[kyorugiDivision].forEach(wc => {
          const option = document.createElement('option');
          option.value = wc;
          option.text = wc;
          weightClassSelect.appendChild(option);
        });
        // 恢復之前的選擇（如果仍然有效）
        if (previousValue && weightClasses[kyorugiDivision].includes(previousValue)) {
          weightClassSelect.value = previousValue;
        }
      }
    }

    // 事件監聽
    document.addEventListener('DOMContentLoaded', () => {
      updateProgress();
      populateDateSelects('birthYear', 'birthMonth', 'birthDay', 'birthDate');
      document.getElementById('beltLevel').addEventListener('change', updateKyorugiOptions);
      document.querySelectorAll('input[name="entry.1924363147"]').forEach(r => r.addEventListener('change', () => {
        updateBeltLevelOptions();
        populateDateSelects('birthYear', 'birthMonth', 'birthDay', 'birthDate');
        updateKyorugiOptions();
      }));
      document.querySelectorAll('input[name="entry.269558714"]').forEach(r => r.addEventListener('change', updateKyorugiOptions));
      document.getElementById('birthYear').addEventListener('change', updateKyorugiOptions);
      document.getElementById('kyorugiDivision').addEventListener('change', updateWeightClassOptions);

      document.getElementById('noMembership').addEventListener('change', () => {
        document.getElementById('membershipNumber').disabled = document.getElementById('noMembership').checked;
        if (document.getElementById('noMembership').checked) document.getElementById('membershipNumber').value = '';
      });

      document.getElementById('copyPhone').addEventListener('change', () => {
        if (document.getElementById('copyPhone').checked) {
          document.getElementById('emergencyPhone').value = document.getElementById('phone').value;
        }
      });
      document.getElementById('phone').addEventListener('input', () => {
        if (document.getElementById('copyPhone').checked) {
          document.getElementById('emergencyPhone').value = document.getElementById('phone').value;
        }
      });

      updateBeltLevelOptions();
      updateKyorugiOptions();
    });
  </script>
</body>
</html>
